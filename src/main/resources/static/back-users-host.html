<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, shrink-to-fit=9">
	<meta name="description" content="Gambolthemes">
	<meta name="author" content="Gambolthemes">
	<title>Barren - Simple Online Event Ticketing System</title>

	<!-- Favicon Icon -->
	<link rel="icon" type="image/png" href="images/fav.png">

	<!-- Stylesheets -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
		rel="stylesheet">
	<link href='vendor/unicons-2.0.1/css/unicons.css' rel='stylesheet'>
	<link href="css/style.css" rel="stylesheet">
	<link href="css/vertical-responsive-menu.min.css" rel="stylesheet">
	<link href="css/datepicker.min.css" rel="stylesheet">
	<link href="css/responsive.css" rel="stylesheet">
	<link href="css/night-mode.css" rel="stylesheet">

	<!-- Vendor Stylesheets -->
	<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
	<link href="vendor/OwlCarousel/assets/owl.carousel.css" rel="stylesheet">
	<link href="vendor/OwlCarousel/assets/owl.theme.default.min.css" rel="stylesheet">
	<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">
	<style>
		.allEditInput {
			border: 1px solid white;
		}

		.contact {
			width: 80px;
		}

		.phone {
			width: 100px;
		}

		.host {
			width: 230px;
		}

		.editbutton {
			width: 15px;
			height: 15px;
			margin-top: 3px;
		}
	</style>
</head>

<body class="d-flex flex-column h-100">
	<!-- Invite Team Member Model Start-->
	<div class="modal fade" id="inviteTeamModal" tabindex="-1" aria-labelledby="inviteTeamModalLabel"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="inviteTeamModalLabel">新增主辦廠商</h5>
					<button type="button" class="close-model-btn" data-bs-dismiss="modal" aria-label="Close"><i
							class="uil uil-multiply"></i></button>
				</div>
				<div class="modal-body">
					<div class="model-content main-form">
						<div class="form-group mt-30">
							<label class="form-label">廠商 &emsp;&emsp;<p id="hostnameError"
									style="color: red; display: inline-block; margin: 0;"></p></label>

							<input id="hostName" class="form-control h_40" type="text" placeholder="請輸入廠商名稱.." value="">
						</div>
						<div class="form-group mt-30">
							<label class="form-label">E-mail &emsp;&emsp;<p id="hostemailError"
									style="color: red; display: inline-block; margin: 0;"></p></label>
							<input id="hostEmail" class="form-control h_40" type="text" placeholder="請輸入email.."
								value="">
						</div>
						<div class="form-group mt-30">
							<label class="form-label">聯絡窗口 &emsp;&emsp;<p id="hostcontactError"
									style="color: red; display: inline-block; margin: 0;"></p></label>
							<input id="hostContact" class="form-control h_40" type="text" placeholder="請輸入窗口姓名.."
								value="">
						</div>
						<div class="form-group mt-30">
							<label class="form-label">電話 &emsp;&emsp;<p id="hostcellError"
									style="color: red; display: inline-block; margin: 0;"></p></label>
							<input id="hostCell" class="form-control h_40" type="tel" placeholder="請輸入聯絡電話.." value="">
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="co-main-btn min-width btn-hover h_40"
						data-bs-dismiss="modal">取消</button>
					<button id="insertHostButton" type="button" class="main-btn min-width btn-hover h_40">新增廠商</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Header Start-->
	<!-- 請加上這行-->
	<link href="css/shawn-scroll-bar.css" rel="stylesheet">

	<header class="header">
		<div class="header-inner">
			<nav
				class="navbar navbar-expand-lg bg-barren barren-head navbar fixed-top justify-content-sm-start pt-0 pb-0 ps-lg-0 pe-2">
				<div class="container-fluid ps-0">
					<button type="button" id="toggleMenu" class="toggle_menu">
						<i class="fa-solid fa-bars-staggered"></i>
					</button>
					<button id="collapse_menu" class="collapse_menu me-4">
						<i class="fa-solid fa-bars collapse_menu--icon "></i>
						<span class="collapse_menu--label"></span>
					</button>
					<button class="navbar-toggler order-3 ms-2 pe-0" type="button" data-bs-toggle="offcanvas"
						data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
						<span class="navbar-toggler-icon">
							<i class="fa-solid fa-bars"></i>
						</span>
					</button>
					<a class="navbar-brand order-1 order-lg-0 ml-lg-0 ml-2 me-auto" href="index.html">
						<div class="res-main-logo">
							<img src="images/logo-icon.svg" alt="">
						</div>
						<div class="main-logo" id="logo">
							<img src="images/logo.svg" alt="">
							<img class="logo-inverse" src="images/dark-logo.svg" alt="">
						</div>
					</a>
					<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar"
						aria-labelledby="offcanvasNavbarLabel">
						<div class="offcanvas-header">
							<div class="offcanvas-logo" id="offcanvasNavbarLabel">
								<img src="images/logo-icon.svg" alt="">
							</div>
							<button type="button" class="close-btn" data-bs-dismiss="offcanvas" aria-label="Close">
								<i class="fa-solid fa-xmark"></i>
							</button>
						</div>
						<div class="offcanvas-body">
							<ul class="navbar-nav justify-content-end flex-grow-1 pe_5">
								<li class="nav-item">
									<a class="nav-link" href="back-index.html">
										<i class="fa-solid fa-house me-2"></i>首頁
									</a>
								</li>
							</ul>
						</div>
					</div>
					<div class="right-header order-2">
						<ul class="align-self-stretch">
							<li>
								<a href="back-activity-ticket-inspec.html" class="create-btn btn-hover">
									<i class="fa-solid fa-ticket"></i>
									<span>票務</span>
								</a>
							</li>
							<li class="dropdown account-dropdown order-3">
								<a href="#" class="account-link" role="button" id="accountClick"
									data-bs-auto-close="outside" data-bs-toggle="dropdown" aria-expanded="false">
									<img src="images/profile-imgs/img-13.jpg" class="D-baimg" alt="">
									<i class="fas fa-caret-down arrow-icon"></i>
								</a>
								<ul class="dropdown-menu dropdown-menu-account dropdown-menu-end"
									aria-labelledby="accountClick">
									<li>
										<div class="dropdown-account-header">
											<div class="account-holder-avatar">
												<img src="images/profile-imgs/img-13.jpg" class="D-baimg" alt="">
											</div>
											<h5 class="D-baname"><!--姓名--></h5>
											<p class="D-baemail" ><!--Email--></p>
										</div>
									</li>
									<li class="profile-link">
										<a href="back-users-profile.html" class="link-item">個人資料管理</a>
										<a href="front-users-bu-sign-in.html" class="link-item logOut">登出</a>
									</li>
								</ul>
							</li>
						</ul>
					</div>
				</div>
			</nav>
			<div class="overlay"></div>
		</div>
	</header>
	<!-- Header End-->
	<!-- Left Sidebar Start -->
	<nav class="vertical_nav" style="overflow: auto!important;">
		<div class="left_section menu_left" id="js-menu">
			<div class="left_section">
				<ul>
					<li class="menu--item">
						<a href="#" class="menu--link" title="最新消息管理" data-bs-toggle="tooltip"
							data-bs-placement="right">
							<i class="fa-solid fa-newspaper menu--icon"></i>
							<span class="menu--label">最新消息管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="#" class="menu--link" title="節目管理" data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-calendar-days menu--icon"></i>
							<span class="menu--label">節目管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="#" class="menu--link" title="節目類別管理" data-bs-toggle="tooltip"
							data-bs-placement="right">
							<i class="fa-solid fa-folder menu--icon"></i>
							<span class="menu--label">節目類別管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="back-activity-seatmgt-allactivity.html" class="menu--link" title="節目座位管理"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-chair menu--icon"></i>
							<span class="menu--label">節目座位管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="back-activity-commentmgt.html" class="menu--link" title="節目評論管理"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-comments menu--icon"></i>
							<span class="menu--label">節目評論管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="back-activity-model-place.html" class="menu--link" title="場地模板管理"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-couch menu--icon"></i>
							<span class="menu--label">場地模板管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="back-product-product_manage.html" class="menu--link" title="商品管理"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-bag-shopping menu--icon"></i>
							<span class="menu--label">商品管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="back-product-pclass_manager.html" class="menu--link" title="商品類別管理"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-regular fa-folder menu--icon"></i>
							<span class="menu--label">商品類別管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="back-product-coupon_manage.html" class="menu--link" title="商品優惠券管理"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-percent menu--icon"></i>
							<span class="menu--label">商品優惠券管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="back-product-comment_manager.html" class="menu--link" title="商品評論管理"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-regular fa-comments menu--icon"></i>
							<span class="menu--label">商品評論管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="back-product-order_manage.html" class="menu--link" title="訂單管理"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-file-invoice menu--icon"></i>
							<span class="menu--label">訂單管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="#" class="menu--link" title="帳務管理" data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-coins menu--icon"></i>
							<span class="menu--label">帳務管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="#" class="menu--link" title="常見問題管理" data-bs-toggle="tooltip"
							data-bs-placement="right">
							<i class="fa-solid fa-question-circle menu--icon"></i>
							<span class="menu--label">常見問題管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="#" class="menu--link" title="客服即時通" data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-headset menu--icon"></i>
							<span class="menu--label">客服即時通</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="back-users-host.html" class="menu--link active" title="主辦單位管理" data-bs-toggle="tooltip"
							data-bs-placement="right">
							<i class="fa-solid fa-square-plus menu--icon"></i>
							<span class="menu--label">主辦單位管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="back-users-member.html" class="menu--link" title="會員資料管理" data-bs-toggle="tooltip"
							data-bs-placement="right">
							<i class="fa-solid fa-user-group menu--icon"></i>
							<span class="menu--label">會員資料管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="back-users-my-team.html" class="menu--link" title="使用者帳號權限管理" data-bs-toggle="tooltip"
							data-bs-placement="right">
							<i class="fa-solid fa-user-secret menu--icon"></i>
							<span class="menu--label">使用者帳號權限管理</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="#" class="menu--link" title="系統參數管理" data-bs-toggle="tooltip"
							data-bs-placement="right">
							<i class="fa-solid fa-gear menu--icon"></i>
							<span class="menu--label">系統參數管理</span>
						</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<!-- Left Sidebar End -->
	<!-- Body Start -->
	<div class="wrapper wrapper-body">
		<div class="dashboard-body">
			<div class="container-fluid">
				<div class="row">
					<div class="col-md-12">
						<div class="d-main-title">
							<h3><i class="fa-solid fa-square-plus me-3"></i>主辦單位管理</h3>
						</div>
					</div>
					<div class="col-md-12">
						<div class="conversion-setup">
							<div class="main-card mt-5">
								<div class="dashboard-wrap-content p-4">
									<div class="d-md-flex flex-wrap align-items-center">
										<div style="width: 50px;">
											<div class="form-group">
												<div class="relative-input position-relative">
													<input class="form-control h_40" id="search" type="text"
														placeholder="搜尋廠商..." value="">
													<i class="uil uil-search"></i>
												</div>
											</div>
										</div>
										<div class="rs ms-auto mt_r4">
											<button class="main-btn btn-hover h_40 w-100" data-bs-toggle="modal"
												data-bs-target="#inviteTeamModal">新增主辦廠商</button>
										</div>
									</div>
								</div>
							</div>
							<div class="tab-content">
								<div class="tab-pane fade active show" id="overview-tab" role="tabpanel">
									<div class="table-card mt-4">
										<div class="main-table">
											<div class="table-responsive">
												<table class="table" id="myTable">
													<thead class="thead-dark">
														<tr>
															<th scope="col">編號/帳號</th>
															<th scope="col">主辦廠商</th>
															<th scope="col">聯絡窗口</th>
															<th scope="col">聯絡E-mail</th>
															<th scope="col">聯絡電話</th>
															<th scope="col">編輯</th>
														</tr>
													</thead>
													<tbody>
														<tr>
															<!-- 廠商資料 -->
														</tr>
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Body End -->

	<script src="js/vertical-responsive-menu.min.js"></script>
	<script src="js/jquery-3.6.0.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="vendor/OwlCarousel/owl.carousel.js"></script>
	<script src="vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
	<script src="js/custom.js"></script>
	<script src="js/datepicker.min.js"></script>
	<script src="js/i18n/datepicker.en.js"></script>
	<script src="js/night-mode.js"></script>
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
	<!-- Kai  backuserData -->
    <script src="js/backuserData.js"></script>

</body>
<script>
	fetch("host/gh")
		.then(response => response.json())
		.then(hostData => {
			hostData.forEach(host => {
				$("tbody").append(`
					<tr>
						<td>${host.hostno}</td>
						<td><input id="name-${host.hostno}" class="name allEditInput ip" value="${host.hostname}" readonly></td>
						<td><input id="contact-${host.hostno}" class="contact allEditInput ip" value="${host.hostcontact}" readonly></td>
						<td><input id="host-${host.hostno}" class="host allEditInput ip" value="${host.hostemail}" readonly></td>
						<td><input id="phone-${host.hostno}" class="phone allEditInput ip" value="${host.hostcell}" readonly></td>
						<td><input type="image" class="editbutton" id="edit-${host.hostno}" img src="images/edit.png"></td>
					</tr>	
				`);

				$(`#edit-${host.hostno}`).click(() => {
					$(`#name-${host.hostno},#contact-${host.hostno},#host-${host.hostno},#phone-${host.hostno}`).toggleClass("allEditInput");

					if ($(`#name-${host.hostno}`).attr("readonly")) {
						$(`#name-${host.hostno},#contact-${host.hostno},#host-${host.hostno},#phone-${host.hostno}`).attr("readonly", false);
					} else {
						$(`#name-${host.hostno},#contact-${host.hostno},#host-${host.hostno},#phone-${host.hostno}`).attr("readonly", true);
						//這邊用fetch儲存編輯修改指令
						const updatedHost = {
							hostno: host.hostno,
							hostname: $(`#name-${host.hostno}`).val(),
							hostcontact: $(`#contact-${host.hostno}`).val(),
							hostemail: $(`#host-${host.hostno}`).val(),
							hostcell: $(`#phone-${host.hostno}`).val(),
						};

						fetch(`/host/${host.hostno}`, {
							method: "POST",
							headers: { "Content-Type": "application/json" },
							body: JSON.stringify(updatedHost)
						}).then(response => {
							if (response.ok) {
								return response.json();
							} else {
								return response.json().then(errors => {
									let errorMessages = Object.values(errors).join("<br>");
									throw new Error(errorMessages);
								});
							}
						}).then(success => {
							swal("修改成功!", "您已經更改了廠商資料了", "success");
						})
							.catch(error => {
								console.error("Error:", error);
								swal("修改失敗!", error.message.replace(/<br>/g, '\n'), "error")
									.then(() => {
										$(`#name-${host.hostno}`).val(`${host.hostname}`);
										$(`#contact-${host.hostno}`).val(`${host.hostcontact}`);
										$(`#host-${host.hostno}`).val(`${host.hostemail}`);
										$(`#phone-${host.hostno}`).val(`${host.hostcell}`);
									});
							});
					}
				})
			});
		})
	//新增新加入的廠商資料功能
	$("#insertHostButton").click(() => {
		const newHostData = {
			hostname: $("#hostName").val(),
			hostemail: $("#hostEmail").val(),
			hostcontact: $("#hostContact").val(),
			hostcell: $("#hostCell").val()
		}
		fetch("host/insertHost", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify(newHostData)
		}).then(response => {
			if (response.ok) {
				return response.json();
			} else {
				return response.json().then(errors => {
					console.log("Error:", errors);
					if (errors.hostname) {
						$("#hostnameError").text(`${errors.hostname}`);
					} else {
						$("#hostnameError").text("");
					}
					if (errors.hostemail) {
						$("#hostemailError").text(`${errors.hostemail}`);
					} else {
						$("#hostemailError").text("");
					}
					if (errors.hostcontact) {
						$("#hostcontactError").text(`${errors.hostcontact}`);
					} else {
						$("#hostcontactError").text("");
					}
					if (errors.hostcell) {
						$("#hostcellError").text(`${errors.hostcell}`);
					} else {
						$("#hostcellError").text("");
					}
					let errorMessages = Object.values(errors).join("<br>");
					throw new Error(errorMessages);
				});
			}
		}).then(success => {
			swal("新增成功!", "您已經新增了一筆廠商資料!", "success")
				.then(() => { location.reload(); })
		}).catch(error => {
			console.error("Error:", error);
		});
	})


	// 當輸入框改變時觸發搜尋
	$("#search").keyup(function () {
		var searchValue = $("#search").val().toLowerCase();
		$("tbody tr").filter(function () {
			//這邊filter會篩選所有value跟searchValue相符合的input
			var trInputValue = $(this).find("input").filter(function () {
				return $(this).val().toLowerCase().indexOf(searchValue) > -1;
			});

			// 如果tr底下 所有文字內容有跟searchValue相符合,textMatches 就會等於 true
			var trText = $(this).text().toLowerCase().indexOf(searchValue) > -1;

			// 如果有符合條件的input會顯示true,不符合就為false,  toggle(true)→顯示  toggle(false)→隱藏
			$(this).toggle(trInputValue.length > 0 || trText);
		});
	});

</script>

</html>