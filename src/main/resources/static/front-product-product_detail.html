<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, shrink-to-fit=9">
	<meta name="description" content="Gambolthemes">
	<meta name="author" content="Gambolthemes">
	<title id="productTitle">商品詳情</title>

	<!-- Favicon Icon -->
	<link rel="icon" type="image/png" href="images/ezTicket.png">

	<!-- Stylesheets -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
		rel="stylesheet">
	<link href='vendor/unicons-2.0.1/css/unicons.css' rel='stylesheet'>
	<link href="css/style.css" rel="stylesheet">
	<link href="css/responsive.css" rel="stylesheet">
	<link href="css/night-mode.css" rel="stylesheet">

	<!-- Vendor Stylesheets -->
	<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
	<link href="vendor/OwlCarousel/assets/owl.carousel.css" rel="stylesheet">
	<link href="vendor/OwlCarousel/assets/owl.theme.default.min.css" rel="stylesheet">
	<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">

</head>

<body class="d-flex flex-column h-100">
	<!-- 檢舉開始 -->
	<div class="modal fade" id="couponModal" tabindex="-1" aria-labelledby="couponModalLabel" aria-hidden="false">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="couponModalLabel">檢舉此則評論</h5>
					<button type="button" class="close-model-btn" data-bs-dismiss="modal" aria-label="Close"><i
							class="uil uil-multiply"></i></button>
				</div>
				<div class="modal-body">
					<div class="model-content main-form">
						<div class="row">
							<div class="col-lg-12 col-md-12">
								<div class="form-group mt-4">
									<label class="form-label">請選擇原因：*</label>
									<input type="hidden" id="pcommentno" value="">
									<input type="hidden" id="memberno" value="">
									<select class="selectpicker" data-size="5" data-live-search="true" id="pwhy">
										<option disabled selected>-----請選擇-----</option>
										<option value="評論含有不當言詞或攻擊性的言論">評論含有不當言詞或攻擊性的言論</option>
										<option value="評論明顯是假評論">評論明顯是假評論</option>
										<option value="評論內容並不符合節目或商品的實際狀況">評論內容並不符合節目或商品的實際狀況</option>
										<option value="評論內容與節目或商品無關">評論內容與節目或商品無關</option>
										<option value="評論內容不當或是令人不適">評論內容不當或是令人不適</option>
									</select>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="co-main-btn min-width btn-hover h_40" data-bs-target="#aboutModal"
						data-bs-toggle="modal" data-bs-dismiss="modal">取消</button>
					<button onclick="submitComment()" class="main-btn min-width btn-hover h_40">提交</button>
				</div>
			</div>
		</div>
	</div>
	<!-- 檢舉結束 -->
	<!-- Header Start-->
	<header class="header">
		<div class="header-inner">
			<nav
				class="navbar navbar-expand-lg bg-barren barren-head navbar fixed-top justify-content-sm-start pt-0 pb-0">
				<div class="container">
					<button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
						data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
						<span class="navbar-toggler-icon">
							<i class="fa-solid fa-bars"></i>
						</span>
					</button>
					<a class="navbar-brand order-1 order-lg-0 ml-lg-0 ml-2 me-auto" href="index.html">
						<div class="res-main-logo">
							<img src="images/ezTicket-icon.svg" alt="">
						</div>
						<div class="main-logo" id="logo">
							<img src="images/ezTicket.svg" alt="">
							<img class="logo-inverse" src="images/dark-logo.svg" alt="">
						</div>
					</a>
					<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar"
						aria-labelledby="offcanvasNavbarLabel">
						<div class="offcanvas-header">
							<div class="offcanvas-logo" id="offcanvasNavbarLabel">
								<img src="images/ezTicket-icon.svg" alt="">
							</div>
							<button type="button" class="close-btn" data-bs-dismiss="offcanvas" aria-label="Close">
								<i class="fa-solid fa-xmark"></i>
							</button>
						</div>
						<div class="offcanvas-body">
							<ul class="navbar-nav justify-content-end flex-grow-1 pe_5">
								<li class="nav-item">
									<a class="nav-link active" aria-current="page" href="index.html">首頁</a>
								</li>
								<li class="nav-item dropdown">
									<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
										aria-expanded="false">
										探索活動
									</a>
									<ul class="dropdown-menu dropdown-submenu">
										<li><a class="dropdown-item" href="explore_events.html">探索活動</a></li>
										<li><a class="dropdown-item" href="#">展覽</a></li>
										<li><a class="dropdown-item" href="#">演唱會</a></li>
										<li><a class="dropdown-item" href="#">音樂劇</a></li>
									</ul>
								</li>
								<li class="nav-item dropdown">
									<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
										aria-expanded="false">
										探索周邊
									</a>
									<ul class="dropdown-menu dropdown-submenu">
										<li><a class="dropdown-item" href="front-product-explore_products.html">探索商品</a>
										</li>
										<li><a class="dropdown-item" href="#">演唱會聯名</a></li>
										<li><a class="dropdown-item" href="#">Youtuber聯名</a>
										</li>
										<li><a class="dropdown-item" href="#">展覽聯名</a></li>
									</ul>
								</li>

								<li class="nav-item dropdown">
									<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
										aria-expanded="false">
										幫助中心
									</a>
									<ul class="dropdown-menu dropdown-submenu">
										<li><a class="dropdown-item" href="#">常見問題</a></li>
										<li><a class="dropdown-item" href="#">線上客服</a></li>
										<li><a class="dropdown-item" href="#">聯絡我們</a></li>
									</ul>
								</li>
								<li class="nav-item">
									<a class="nav-link active" aria-current="page" href="#"
										style="color:black !important">最新消息</a>
								</li>

							</ul>
						</div>
						<div class="offcanvas-footer">
							<div class="offcanvas-social">
								<h5>Follow Us</h5>
								<ul class="social-links">
									<li><a href="#" class="social-link"><i class="fab fa-facebook-square"></i></a>
									<li><a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
									<li><a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
									<li><a href="#" class="social-link"><i class="fab fa-linkedin-in"></i></a>
									<li><a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
								</ul>
							</div>
						</div>
					</div>
					<div class="right-header order-2">
						<ul class="align-self-stretch">
							<li>
								<a href="explore_events.html" class="create-btn btn-hover">
									<i class="fa-solid fa-calendar-days"></i>
									<span>活動訂票</span>
								</a>
								<a href="front-product-explore_products.html" class="create-btn btn-hover">
									<i class="fa-sharp fa-solid fa-bag-shopping"></i>
									<span>聯名商品</span>
								</a>
							</li>
							<li>

							</li>
							<li class="dropdown account-dropdown">
								<a href="#" class="account-link" role="button" id="accountClick"
									data-bs-auto-close="outside" data-bs-toggle="dropdown" aria-expanded="false">
									<img src="images/profile-imgs/img-13.jpg" alt="">
									<i class="fas fa-caret-down arrow-icon"></i>
								</a>
								<ul class="dropdown-menu dropdown-menu-account dropdown-menu-end"
									aria-labelledby="accountClick">
									<li>
										<div class="dropdown-account-header">
											<div class="account-holder-avatar">
												<img src="images/profile-imgs/img-13.jpg" alt="">
											</div>
											<h5>會員名稱</h5>
											<p>johndoe@example.com</p>
										</div>
									</li>
									<li class="profile-link">
										<a class="dropdown-item pe-5" href="front-users-member-profile.html">會員資訊</a>
										<a class="dropdown-item pe-5" href="front-users-mem-sign-in.html">登入</a>
										<a class="dropdown-item pe-5" href="front-users-sign-up.html">註冊</a>
										<a class="dropdown-item pe-5" href="front-users-forgot-pwd.html">忘記密碼</a>

									</li>
								</ul>
							</li>
							<li>
								<div class="night_mode_switch__btn">
									<div id="night-mode" class="fas fa-moon fa-sun"></div>
								</div>
							</li>

							<li class="dropdown account-dropdown">
								<a href="front-product-shopping_cart.html" class="account-link">
									<div id="cart">
										<img src="images/profile-imgs/cart2.jpg">
										<span class="badge" style="color:#102743 ;">0</span>
									</div>
								</a>
							</li>

						</ul>
					</div>
				</div>
			</nav>
			<div class="overlay"></div>
		</div>
	</header>
	<!-- Header End-->
	<!-- Body Start-->
	<div class="wrapper">
		<div class="breadcrumb-block">
			<div class="container">
				<div class="row">
					<div class="col-lg-12 col-md-10">
						<div class="barren-breadcrumb">
							<nav aria-label="breadcrumb">
								<ol class="breadcrumb">
									<li class="breadcrumb-item"><a href="index.html">首頁</a></li>
									<li class="breadcrumb-item"><a href="front-product-explore_products.html">周邊商品</a>
									</li>
									<li class="breadcrumb-item active" aria-current="page" id="pclassName">Online Event
										Detail View</li>
								</ol>
							</nav>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="event-dt-block p-80">
			<div class="container">
				<div class="row" id="productInfo">
					<div class="col-xl-12 col-lg-12 col-md-12">
						<div class="event-top-dts">
							<div class="event-top-dt">
								<h3 class="event-main-title">商品名稱</h3>
								<div class="event-top-info-status">
									商品類別：<span class="event-type-name"><i class="fa-solid fa-video"></i></span>
									開賣時間：<span class="event-type-name details-hr"><span class="ev-event-date">Wed, Jun
											01, 2022 5:30 AM</span></span>
									主辦單位：<span class="event-type-name details-host"><span
											class="ev-event-date">XX娛樂</span></span>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-8 col-lg-7 col-md-12">
						<div class="main-event-dt">
							<div class="event-img" id="productImg">
								<img src="images/event-imgs/big-1.jpg" alt="">
							</div>
							<div class="owl-carousel moreImgs-slider owl-theme" id="moreProductImg">
								<!-- 商品圖片擺放處 -->
							</div>
							<div class="share-save-btns dropdown">
								<button class="sv-btn me-2" onclick="followProduct()"><i
										class="fa-regular fa-bookmark me-2"></i>Save</button>
								<button class="sv-btn" data-bs-toggle="dropdown" aria-expanded="false"><i
										class="fa-solid fa-share-nodes me-2"></i>Share</button>
								<ul class="dropdown-menu">
									<li><a class="dropdown-item" href="#"><i
												class="fa-brands fa-facebook me-3"></i>Facebook</a></li>
									<li><a class="dropdown-item" href="#"><i
												class="fa-brands fa-twitter me-3"></i>Twitter</a></li>
									<li><a class="dropdown-item" href="#"><i
												class="fa-brands fa-linkedin-in me-3"></i>LinkedIn</a></li>
									<li><a class="dropdown-item" href="#"><i
												class="fa-regular fa-envelope me-3"></i>Email</a></li>
								</ul>
							</div>
							<div class="main-event-content">
								<h4>About This Event</h4>
								<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin dolor justo,
									sodales
									mattis orci et, mattis faucibus est. Nulla semper consectetur sapien a tempor.
									Ut
									vel lacus lorem. Nulla mauris massa, pharetra a mi ut, mattis euismod libero. Ut
									pretium bibendum urna nec egestas. Etiam tempor vehicula libero. Aenean cursus
									venenatis orci, ac porttitor leo porta sit amet. Nulla eleifend mollis enim sed
									rutrum. Nunc cursus ex a ligula consequat aliquet. Donec semper tellus ac ante
									vestibulum, vitae varius leo mattis. In vestibulum blandit tempus. Etiam elit
									turpis, volutpat hendrerit varius ut, posuere a sapien. Maecenas molestie
									bibendum
									finibus. Nulla euismod neque vel sem hendrerit faucibus. Nam sit amet metus
									sollicitudin, luctus eros at, consectetur libero.</p>
								<p>In malesuada luctus libero sed gravida. Suspendisse nunc est, maximus vel viverra
									nec, suscipit non massa. Maecenas efficitur vestibulum pellentesque. Ut finibus
									ullamcorper congue. Sed ut libero sit amet lorem venenatis facilisis. Mauris
									egestas
									tortor vel massa auctor, eget gravida mauris cursus. Etiam elementum semper
									fermentum. Suspendisse potenti. Morbi lobortis leo urna, non laoreet enim
									ultricies
									id. Integer id felis nec sapien consectetur porttitor. Proin tempor mauris in
									odio
									iaculis semper. Cras ultricies nulla et dui viverra, eu convallis orci
									fermentum.
								</p>
							</div>
						</div>
					</div>
					<div class="col-xl-4 col-lg-5 col-md-12">
						<div class="main-card event-right-dt">
							<div class="bp-title" id="productRate">
								<!-- 商品評星：1.5 定位位置 -->
								<h4><i class="fa fa-star fa-2x" style="width: 20px"></i><i
										class="fa fa-star-o fa-2x"></i></h4>
							</div>

							<!-- <div class="time-left">
								<div class="countdown">
									<div class="countdown-item">
										<span id="day"></span>days
									</div>
									<div class="countdown-item">
										<span id="hour"></span>Hours
									</div>
									<div class="countdown-item">
										<span id="minute"></span>Minutes
									</div>
									<div class="countdown-item">
										<span id="second"></span>Seconds
									</div>
								</div>
							</div> -->
							<div class="event-dt-right-group mt-5">
								<div class="event-dt-right-icon">
									<i class="fa-solid fa-money-check-dollar"></i>
								</div>
								<div class="event-dt-right-content">
									<h4>NTD</h4>
									<h5 class="mb-0" id="pprice" style="text-decoration: line-through">$50.00</h5>
									<h5 class="mb-0" id="pspecialprice" style="font-size: 20px;">$50.00</h5>
									<!-- <div class="quantity"> -->
									<!-- </div> -->
									<!-- <div class="col-md-6">
										<label class="form-label mt-3 fs-6">欲購買數量</label>
										<div class="input-number">
											<input class="form-control h_50" type="number" placeholder="" value="1">
										</div>
									</div> -->
								</div>
								<div class="counter">
									<span class="down" onClick='decreaseCount(event, this)'>-</span>
									<input id="count" type="text" value="1">
									<span class="up" onClick='increaseCount(event, this)'>+</span>
								</div>
							</div>


							<div class="booking-btn">
								<button type="button" id="buyNow" class="main-btn btn-hover w-45" style="width:48%;">Buy
									Now</button>
								<button type="button" class="main-btn btn-hover w-45" style="width:48%;"
									id="product-incart"><i class="fa-solid fa-cart-shopping"></i></button>
							</div>
						</div>
					</div>

					<!-- 評論 -->
					<div class="col-xl-12 col-lg-12 col-md-12">
						<div class="testimonial-block p-80">
							<!-- height 有調整 -->
							<div class="container" style="height: 325px;">
								<div class="row">
									<div class="col-lg-12">
										<div class="testimonial-slider-area">
											<div class="owl-carousel testimonial-slider owl-theme">


											</div>
										</div>
									</div>
								</div>
							</div>
						</div>


					</div>
					<div class="col-xl-12 col-lg-12 col-md-12">
						<div class="more-events">
							<div class="main-title position-relative">
								<h3>相關聯商品</h3>
								<a href="front-product-explore_products.html" class="view-all-link">瀏覽更多<i
										class="fa-solid fa-right-long ms-2"></i></a>
							</div>
							<div class="owl-carousel moreEvents-slider owl-theme" id="moreProducts">
								<!-- 相關聯商品擺放處 -->
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Body End-->
	<!-- Footer Start-->
	<footer class="footer mt-auto">
		<div class="footer-top">
			<div class="container">
				<div class="row">
					<div class="col-lg-3 col-md-6">
						<div class="footer-content">
							<h4>Company</h4>
							<ul class="footer-link-list">
								<li><a href="about_us.html" class="footer-link">About Us</a></li>
								<li><a href="help_center.html" class="footer-link">Help Center</a></li>
								<li><a href="faq.html" class="footer-link">FAQ</a></li>
								<li><a href="contact_us.html" class="footer-link">Contact Us</a></li>
							</ul>
						</div>
					</div>
					<div class="col-lg-3 col-md-6">
						<div class="footer-content">
							<h4>Useful Links</h4>
							<ul class="footer-link-list">
								<li><a href="create.html" class="footer-link">Create Event</a></li>
								<li><a href="sell_tickets_online.html" class="footer-link">Sell Tickets
										Online</a>
								</li>
								<li><a href="privacy_policy.html" class="footer-link">Privacy Policy</a>
								</li>
								<li><a href="term_and_conditions.html" class="footer-link">Terms &
										Conditions</a>
								</li>
							</ul>
						</div>
					</div>
					<div class="col-lg-3 col-md-6">
						<div class="footer-content">
							<h4>Resources</h4>
							<ul class="footer-link-list">
								<li><a href="pricing.html" class="footer-link">Pricing</a></li>
								<li><a href="our_blog.html" class="footer-link">Blog</a></li>
								<li><a href="refer_a_friend.html" class="footer-link">Refer a Friend</a>
								</li>
							</ul>
						</div>
					</div>
					<div class="col-lg-3 col-md-6">
						<div class="footer-content">
							<h4>Follow Us</h4>
							<ul class="social-links">
								<li><a href="#" class="social-link"><i class="fab fa-facebook-square"></i></a>
								<li><a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
								<li><a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
								<li><a href="#" class="social-link"><i class="fab fa-linkedin-in"></i></a>
								<li><a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
							</ul>
						</div>
						<div class="footer-content">
							<h4>Download Mobile App</h4>
							<div class="download-app-link">
								<a href="#" class="download-btn"><img src="images/app-store.png" alt=""></a>
								<a href="#" class="download-btn"><img src="images/google-play.png" alt=""></a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="footer-bottom">
			<div class="container">
				<div class="row">
					<div class="col-12">
						<div class="footer-copyright-text">
							<p class="mb-0">© 2022, <strong>Barren</strong>. All rights reserved. Powered by
								Gambolthemes</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</footer>
	<!-- Footer End-->

	<!-- 接收來自後端的資料 -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="js/my_porder.js"></script>
	<script src="js/jquery-3.6.0.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="vendor/OwlCarousel/owl.carousel.js"></script>
	<script src="vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
	<script src="js/custom.js"></script>
	<script src="js/night-mode.js"></script>
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>



	<script>
		// const productInfo = document.querySelector('#productInfo');
		const pname = document.querySelector('h3.event-main-title');
		const pclass = document.querySelector('span.event-type-name');
		const psdate = document.querySelector('span.event-type-name.details-hr');
		const hostno = document.querySelector('span.event-type-name.details-host');
		const pimg = document.querySelector('#productImg');
		const pdiscrip = document.querySelector('div.main-event-content');
		const pprice = document.querySelector('#pprice');
		const pspecialprice = document.querySelector('#pspecialprice');




		//商品詳情資訊
		let urlParams = new URLSearchParams(window.location.search);
		const productno = urlParams.get('productno');

		$('#product-incart').click(function () {
			let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
			let qty = document.querySelector('#count').value;
			let itemqty;
			for (item of cartItems) {
				if (item.data.productno == productno) {
					itemqty = item;
				}
			}
			if (itemqty) {
				itemqty.quantity += parseInt(qty);
				localStorage.setItem('cartItems', JSON.stringify(cartItems));
			} else {
				// console.log("點擊加入購物車: " + productno);
				addCart(productno);
			}
			// 獲取購物車元素
			let cart = document.getElementById('cart');
			// 獲取購物車商品數量元素
			let badge = cart.querySelector('.badge');
			// 設置初始購物車商品數量為 0
			let count = 0;
			// 載入未結帳商品數量
			$(document).ready(() => {
				if (cartItems.length !== 0) {
					for (item of cartItems) {
						count += Number(item.quantity);
					}
					badge.innerHTML = count;
				}
			})
		});
		$('#buyNow').click(function () {
			buyNow(productno);
		});

		fetch('ProductInfoServlet', {
			method: 'POST',
			body: new URLSearchParams({
				'action': "singleProduct",
				'productno': productno
			})
		}).then(resp => resp.json())
			.then(item => {
				console.log(item);
				$("#productTitle").text(item.pname);
				$("#pclassName").text(item.pclass.pclassname);
				pname.textContent = item.pname;
				pclass.textContent = item.pclass.pclassname;
				psdate.textContent = item.psdate;
				hostno.textContent = item.host.hostname;
				pimg.innerHTML = `<img src="ProductImg?pimgno=${item.pimgts[0].pimgno}" alt="">`;
				pdiscrip.textContent = item.pdiscrip;
				pprice.textContent = item.pprice;
				pspecialprice.textContent = item.pspecialprice;
				if (item.prateqty < 1) {
					$("#productRate").children("h4").text('尚無評論');
				}
				else if (item.prateqty >= 1) {
					//.toFixed(2) 呈現至小數點後兩位數
					$("#productRate").children("h4").text("商品評星：" + Math.round((item.pratetotal / item.prateqty)).toFixed(1)).append(`&nbsp;<i class="fa-solid fa-star" style="color: #ffad21!important;"></i>`);
				}
				for (let pimgt of item.pimgts) {
					console.log(pimgt.pimgno);
					$("#moreProductImg").append(
						`<div class="item">
													<div class="main-card mt-4">
														<div class="event-thumbnail">
															<a href="front-product-product_detail.html?productno=${item.productno}" class="thumbnail-img">
																<img src="ProductImg?pimgno=${pimgt.pimgno}" alt="">
															</a>
										</div>
									</div>
								</div>`);

				}


			}).then(function () {
				$('.moreImgs-slider').owlCarousel({
					items: 7,
					loop: false,
					margin: 20,
					nav: true,
					dots: false,
					navText: ["<i class='uil uil-angle-left'></i>", "<i class='uil uil-angle-right'></i>"],
					responsive: {
						0: {
							items: 1
						},
						600: {
							items: 2
						},
						800: {
							items: 2
						},
						1000: {
							items: 3
						},
						1200: {
							items: 4
						},
						1400: {
							items: 4
						}
					}
				})
			});



		//相關聯商品
		const moreProduct = document.querySelector('div.owl-carousel.moreEvents-slider.owl-theme');

		fetch('ProductInfoServlet', {
			method: 'POST',
			body: new URLSearchParams({
				'action': "availableProductList"
			})
		}).then(resp => resp.json())
			.then(list => {
				for (let item of list) {
					let image = item.pimgts && item.pimgts[0] && item.pimgts[0].pimgno;
					if (image === undefined) { image = 70001; }

					$("#moreProducts").append(`
					<div class="item">
			<div class="main-card mt-4">
				<div class="event-thumbnail">
					<a href="front-product-product_detail.html?productno=${item.productno}" class="thumbnail-img">
						<img src="ProductImg?pimgno=${image}" alt="">

					</a>
					<span class="bookmark-icon" title="Bookmark" onclick="moreProductFollowProduct(${item.productno})"></span>
				</div>
				<div class="event-content">
					<a href="front-product-product_detail.html?productno=${item.productno}" class="event-title">${item.pname}</a>
					<div class="duration-price-remaining">
						<span class="duration-price" style="text-decoration: line-through">${item.pprice}</span>
						<span class="duration-price" style="font-size: 20px;">${item.pspecialprice}</span>
						<span class="remaining" id="rateAvg${item.productno}"><i class="fa fa-star" aria-hidden="true"></i></span>
					</div>
				</div>
				<div class="event-footer">
					
						<a onclick="buyNow(${item.productno})" class="main-btn btn-hover w-45" style="width:48%;">Buy Now</a>
						<button type="button" class="main-btn btn-hover w-45" style="width:48%;" onclick="addCart(${item.productno})" id="product-incart"><i class="fa-solid fa-cart-shopping"></i></button>
					
					
				</div>
			</div>
		</div>`);
					if (item.prateqty < 1) {
						$("#rateAvg" + item.productno).text('尚無評星')
					}
					else if (item.prateqty >= 1) {
						$("#rateAvg" + item.productno).text("商品評星：" + ((item.pratetotal / item.prateqty)).toFixed(1)).append(`&nbsp;<i class="fa-solid fa-star" style="color: #ffad21!important;"></i>`);
					}
				}
			}
			).then(function () {
				$('.moreEvents-slider').owlCarousel({
					items: 7,
					loop: true,
					margin: 20,
					nav: true,
					dots: false,
					navText: ["<i class='uil uil-angle-left'></i>", "<i class='uil uil-angle-right'></i>"],
					responsive: {
						0: {
							items: 1
						},
						600: {
							items: 2
						},
						800: {
							items: 2
						},
						1000: {
							items: 3
						},
						1200: {
							items: 4
						},
						1400: {
							items: 4
						}
					}
				})
			})

		//商品評論

		const productComment = document.querySelector('div.owl-carousel.testimonial-slider.owl-theme');

		// 從 Redis 撈出會員所對應的按讚評論編號並存到一個陣列以供後續比對
		let commentArr = [];

		fetch("ProductCommentServlet", {
			method: "POST",
			body: new URLSearchParams({
				'action': "oneProductCommentList",
				'productno': productno
			})
		})
			.then(resp => resp.json())
			.then(list => {
				for (let item of list) {
					productComment.innerHTML += `<div class="item">
													<div class="main-card">
														<div class=" testimonial-content">
															<div class="testimonial-text">
																<p>${item.pcommentcont}
																</p>
															</div>
															<div class=" testimonial-user-dt">
																<h5>評論者${item.memberno}</h5>
																<span>評論日期${item.pcommentdate}</span>
																<ul id="starContainer_${item.pcommentno}">
																	
																</ul>

																<!-- 點讚/檢舉 -->
																<table>
																	<tr style="height: 40px; ">
																		<td style="padding-top: 4px; width: 35px;">
																			<button
																				style="border: none; background-color: transparent;">
																				<img id="thumb_${item.pcommentno}" name="thumbbtn"
																					style="width: 30px;"
																					src="images/thumbup_blank.png"
																					onclick="chgthumbimg()">
																			</button>
																		</td>
																		<td style="width: 30px;" id="plike_${item.pcommentno}">${item.plike}</td>
																		<td><button  name="${item.pcommentno}" data-bs-toggle="modal"
																				data-bs-target="#couponModal" 
																				style="border: none; background-color: transparent" onclick="comment(this.name)">
																				<img style="padding-top: 4px; width: 30px;"
																					src="images/comment.png"></button>
																		</td>
																	</tr>
																</table>

																<!-- 檢舉評論 -->
																<!-- <table>
																						<tr>
																							<button data-bs-toggle="modal"
																								data-bs-target="#couponModal"
																								style="border:0; border-radius:5px; font-size: 10px; background-color: rgb(239, 237, 237);">檢舉評論</button>
																						</tr>
																					</table> -->

															</div>
															<span class="quote-icon"><i
																	class="fa-solid fa-quote-right"></i></span>
														</div>
													</div>
												</div>`;

					for (let star = 0; star < item.prate; star++) {
						$(`#starContainer_${item.pcommentno}`).append(`<li><i class="fa-solid fa-star"></i></li>`);
					}
				}

				// Document load 的時候顯示按過的讚，$(`#thumb_${i}`) 要新增在空讚的圖片中
				$.ajax({
					url: "ProductCommentServlet",
					cache: false,
					async: false,
					type: 'POST',
					dataType: "json",
					data: {
						"action": "getThumpupPcommentno",
						"memberno": info.memberno,
					},
					success: function (jsondata) {
						checkUpArr = Object.values(jsondata)
						for (let i of checkUpArr) {
							console.log(i);
							if (checkUpArr.includes(i)) {
								console.log("點讚圖示");
								$(`#thumb_${i}`).attr('src', 'images/thumbup_clicked.png');
								$(`#thumb_${i}`).addClass("thumbbed");
							}
						}
					}

				})


			}).then(function () {
				$('.testimonial-slider').owlCarousel({
					items: 10,
					loop: true,
					margin: 20,
					nav: false,
					dots: true,
					smartSpeed: 800,
					autoplay: true,
					autoplayTimeout: 3000,
					autoplayHoverPause: true,
					responsive: {
						0: {
							items: 1
						},
						600: {
							items: 1
						},
						1000: {
							items: 2
						},
						1200: {
							items: 2
						},
						1400: {
							items: 2
						}
					}
				})
			});


	</script>


	<script>

		//會員編號假資料
		const info = {
			memberno: 85346,
		}

		//從評論取得評論編號
		function comment(pcommentno) {
			$('#pcommentno').val(pcommentno);
			$('#memberno').val(info.memberno);
			console.log("comment" + $("#pcommentno").val());
		}

		//新增商品評論檢舉
		function submitComment() {
			console.log($("#pcommentno").val());

			fetch('ProductCommentReportServlet', {
				method: 'POST',
				headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
				body: new URLSearchParams({
					'memberno': info.memberno,
					// 'productno':  productno,
					'pcommentno': $("#pcommentno").val(),
					'pwhy': $('#pwhy').val(),
					'action': "addProductCommentReport"
				})
			}).then(resp => resp.json())
				.then(item => {
					if (item.pcommentno) {
						swal({
							title: "檢舉成功",
							icon: "success",
							closeOnClickOutside: true,
						})
					} else {
						swal({
							title: "檢舉失敗",
							icon: "error",
							closeOnClickOutside: true,
						})
					}
				})
		}
		//新增商品追蹤(單一商品)
		function followProduct() {

			fetch("FollowproductController", {
				method: "POST",
				body: new URLSearchParams({
					'memberno': info.memberno,
					'productno': productno,
					'action': "addOneProductFollow"
				})
			})
		}

		//相關聯商品的追蹤
		function moreProductFollowProduct(productno) {

			fetch("FollowproductController", {
				method: "POST",
				body: new URLSearchParams({
					'memberno': info.memberno,
					'productno': productno,
					'action': "addOneProductFollow"
				})
			})
		}


	</script>







	<!-- 點讚換圖 -->
	<script>
		function chgthumbimg() {
			const btnClass = event.target.className;
			const pcommentno = event.target.id.replace("thumb_", "");

			if (btnClass === '') {
				event.target.src = 'images/thumbup_clicked.png';
				event.target.classList.add("thumbbed");
				$.ajax({
					url: "ProductCommentServlet",
					async: false,
					type: 'POST',
					dataType: "json",
					data: {
						"action": "thumpupPcomment",
						"memberno": info.memberno,
						"pcommentno": pcommentno
					},
					success: function (jsondata) {
						let plikeEl = $(`plike_${pcommentno}`)
						console.log(plikeEl);
						let plikeOld=plikeEl.text();
						console.log(plikeOld);
						console.log(typeof plikeOld);
						plikeEl.text(1+plikeOld);

					}
				})
			}
			else {
				event.target.src = 'images/thumbup_blank.png';
				event.target.classList.remove("thumbbed");
				$.ajax({
					url: "ProductCommentServlet",
					async: false,
					type: 'POST',
					dataType: "json",
					data: {
						"action": "thumpdownPcomment",
						"memberno": info.memberno,
						"pcommentno": pcommentno
					},
					success: function (jsondata) {
					}
				})
			}
		}



	</script>





</body>

</html>