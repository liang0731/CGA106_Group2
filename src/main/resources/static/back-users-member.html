<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, shrink-to-fit=9">
	<meta name="description" content="Gambolthemes">
	<meta name="author" content="Gambolthemes">
	<title>Barren - Simple Online Event Ticketing System</title>

	<!-- Favicon Icon -->
	<link rel="icon" type="image/png" href="images/fav.png">

	<!-- Stylesheets -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
		rel="stylesheet">
	<link href='vendor/unicons-2.0.1/css/unicons.css' rel='stylesheet'>
	<link href="css/style.css" rel="stylesheet">
	<link href="css/vertical-responsive-menu.min.css" rel="stylesheet">
	<link href="css/datepicker.min.css" rel="stylesheet">
	<link href="css/responsive.css" rel="stylesheet">
	<link href="css/night-mode.css" rel="stylesheet">

	<!-- Vendor Stylesheets -->
	<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
	<link href="vendor/OwlCarousel/assets/owl.carousel.css" rel="stylesheet">
	<link href="vendor/OwlCarousel/assets/owl.theme.default.min.css" rel="stylesheet">
	<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<style>
		.member {
			border: 1px solid white;
		}

		.allInput {
			border: 1px solid white;
		}

		.birthday {
			width: 100px;
		}

		.address {
			width: 180px;
		}

		.phone {
			width: 90px;
		}

		.member {
			width: 80px;
		}

		.iconbutton {
			width: 20px;
			height: 20px;
			vertical-align: top;
		}

		.editbutton {
			width: 15px;
			height: 15px;
			margin-top: 3px;
		}
	</style>
</head>

<!-- Header Start-->
    <!-- 請加上這行-->
    <link href="css/shawn-scroll-bar.css" rel="stylesheet">

    <header class="header">
        <div class="header-inner">
            <nav
                class="navbar navbar-expand-lg bg-barren barren-head navbar fixed-top justify-content-sm-start pt-0 pb-0 ps-lg-0 pe-2">
                <div class="container-fluid ps-0">
                    <button type="button" id="toggleMenu" class="toggle_menu">
                        <i class="fa-solid fa-bars-staggered"></i>
                    </button>
                    <button id="collapse_menu" class="collapse_menu me-4">
                        <i class="fa-solid fa-bars collapse_menu--icon "></i>
                        <span class="collapse_menu--label"></span>
                    </button>
                    <button class="navbar-toggler order-3 ms-2 pe-0" type="button" data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
                        <span class="navbar-toggler-icon">
                            <i class="fa-solid fa-bars"></i>
                        </span>
                    </button>
                    <a class="navbar-brand order-1 order-lg-0 ml-lg-0 ml-2 me-auto" href="index.html">
                        <div class="res-main-logo">
                            <img src="images/ezTicket-icon.svg" alt="">
                        </div>
                        <div class="main-logo" id="logo">
                            <img src="images/ezTicket.svg" alt="">
                            <img class="logo-inverse" src="images/dark-logo.svg" alt="">
                        </div>
                    </a>
                    <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar"
                        aria-labelledby="offcanvasNavbarLabel">
                        <div class="offcanvas-header">
                            <div class="offcanvas-logo" id="offcanvasNavbarLabel">
                                <img src="images/ezTicket-icon.svg" alt="">
                            </div>
                            <button type="button" class="close-btn" data-bs-dismiss="offcanvas" aria-label="Close">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </div>
                        <div class="offcanvas-body">
                            <ul class="navbar-nav justify-content-end flex-grow-1 pe_5">
                                <li class="nav-item">
                                    <a class="nav-link" href="back-index.html">
                                        <i class="fa-solid fa-house me-2"></i>首頁
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="right-header order-2">
                        <ul class="align-self-stretch">
                            <li class="6">
                                <a href="back-activity-ticket-inspec.html" class="create-btn btn-hover">
                                    <i class="fa-solid fa-ticket"></i>
                                    <span>票務</span>
                                </a>
                            </li>
                            <li class="dropdown account-dropdown order-3">
                                <a href="#" class="account-link" role="button" id="accountClick"
                                    data-bs-auto-close="outside" data-bs-toggle="dropdown" aria-expanded="false">
                                    <img src="images/profile-imgs/img-13.jpg" class="D-baimg" alt="">
                                    <i class="fas fa-caret-down arrow-icon"></i>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-account dropdown-menu-end"
                                    aria-labelledby="accountClick">
                                    <li>
                                        <div class="dropdown-account-header">
                                            <div class="account-holder-avatar">
                                                <img src="images/profile-imgs/img-13.jpg" class="D-baimg" alt="">
                                            </div>
                                            <h5 class="D-baname"><!-- 姓名 --></h5>
                                            <p class="D-baemail"><!-- email --></p>
                                        </div>
                                    </li>
                                    <li class="profile-link">
                                        <a href="back-users-profile.html" class="link-item">個人資料管理</a>
                                        <a href="front-users-bu-sign-in.html" class="link-item logOut">登出</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <div class="overlay"></div>
        </div>
    </header>
    <!-- Header End-->
    <!-- Left Sidebar Start -->
    <nav class="vertical_nav" style="overflow: auto!important;">
        <div class="left_section menu_left" id="js-menu">
            <div class="left_section">
                <ul>
                    <div  id="havefunc" style="text-align: center; margin-top: 10px; background-color: rgb(187, 199, 228);">
                        <p class="D-barole" style="color: black;"></p>
                    </div>
                    <li class="menu--item 10">
                        <!-- 缺網址 -->
                        <a href="#" class="menu--link" title="最新消息管理" data-bs-toggle="tooltip"
                            data-bs-placement="right">
                            <i class="fa-solid fa-newspaper menu--icon"></i>
                            <span class="menu--label">最新消息管理</span>
                        </a>
                    </li>
                    <li class="menu--item 19">
                        <!-- 缺網址 -->
                        <a href="#" class="menu--link" title="節目管理" data-bs-toggle="tooltip" data-bs-placement="right">
                            <i class="fa-solid fa-calendar-days menu--icon"></i>
                            <span class="menu--label">節目管理</span>
                        </a>
                    </li>
                    <li class="menu--item 19">
                        <!-- 缺網址 -->
                        <a href="#" class="menu--link" title="節目類別管理" data-bs-toggle="tooltip"
                            data-bs-placement="right">
                            <i class="fa-solid fa-folder menu--icon"></i>
                            <span class="menu--label">節目類別管理</span>
                        </a>
                    </li>
                    <li class="menu--item 21">
                        <a href="back-activity-seatmgt-allactivity.html" class="menu--link" title="節目座位管理"
                            data-bs-toggle="tooltip" data-bs-placement="right">
                            <i class="fa-solid fa-chair menu--icon"></i>
                            <span class="menu--label">節目座位管理</span>
                        </a>
                    </li>
                    <li class="menu--item 20">
                        <a href="back-activity-commentmgt.html" class="menu--link" title="節目評論管理"
                            data-bs-toggle="tooltip" data-bs-placement="right">
                            <i class="fa-solid fa-comments menu--icon"></i>
                            <span class="menu--label">節目評論管理</span>
                        </a>
                    </li>
                    <li class="menu--item 22">
                        <a href="back-activity-model-place.html" class="menu--link" title="場地模板管理"
                            data-bs-toggle="tooltip" data-bs-placement="right">
                            <i class="fa-solid fa-couch menu--icon"></i>
                            <span class="menu--label">場地模板管理</span>
                        </a>
                    </li>
                    <li class="menu--item 17">
                        <a href="back-product-product_manage.html" class="menu--link" title="商品管理"
                            data-bs-toggle="tooltip" data-bs-placement="right">
                            <i class="fa-solid fa-bag-shopping menu--icon"></i>
                            <span class="menu--label">商品管理</span>
                        </a>
                    </li>
                    <li class="menu--item 17">
                        <a href="back-product-pclass_manager.html" class="menu--link" title="商品類別管理"
                            data-bs-toggle="tooltip" data-bs-placement="right">
                            <i class="fa-regular fa-folder menu--icon"></i>
                            <span class="menu--label">商品類別管理</span>
                        </a>
                    </li>
                    <li class="menu--item 12">
                        <a href="back-product-coupon_manage.html" class="menu--link" title="商品優惠券管理"
                            data-bs-toggle="tooltip" data-bs-placement="right">
                            <i class="fa-solid fa-percent menu--icon"></i>
                            <span class="menu--label">商品優惠券管理</span>
                        </a>
                    </li>
                    <li class="menu--item 16">
                        <a href="back-product-comment_manager.html" class="menu--link" title="商品評論管理"
                            data-bs-toggle="tooltip" data-bs-placement="right">
                            <i class="fa-regular fa-comments menu--icon"></i>
                            <span class="menu--label">商品評論管理</span>
                        </a>
                    </li>
                    <li class="menu--item 15">
                        <a href="back-product-order_manage.html" class="menu--link" title="訂單管理"
                            data-bs-toggle="tooltip" data-bs-placement="right">
                            <i class="fa-solid fa-file-invoice menu--icon"></i>
                            <span class="menu--label">訂單管理</span>
                        </a>
                    </li>
                    <li class="menu--item 13">
                        <!-- 缺網址 -->
                        <a href="#" class="menu--link" title="帳務管理" data-bs-toggle="tooltip" data-bs-placement="right">
                            <i class="fa-solid fa-coins menu--icon"></i>
                            <span class="menu--label">帳務管理</span>
                        </a>
                    </li>
                    <li class="menu--item 4">
                        <!-- 缺網址 -->
                        <a href="#" class="menu--link" title="常見問題管理" data-bs-toggle="tooltip"
                            data-bs-placement="right">
                            <i class="fa-solid fa-question-circle menu--icon"></i>
                            <span class="menu--label">常見問題管理</span>
                        </a>
                    </li>
                    <li class="menu--item 5">
                        <!-- 缺網址 -->
                        <a href="#" class="menu--link" title="客服即時通" data-bs-toggle="tooltip" data-bs-placement="right">
                            <i class="fa-solid fa-headset menu--icon"></i>
                            <span class="menu--label">客服即時通</span>
                        </a>
                    </li>
                    <li class="menu--item 14">
                        <a href="back-users-host.html" class="menu--link" title="主辦單位管理" data-bs-toggle="tooltip"
                            data-bs-placement="right">
                            <i class="fa-solid fa-square-plus menu--icon"></i>
                            <span class="menu--label">主辦單位管理</span>
                        </a>
                    </li>
                    <li class="menu--item 3">
                        <a href="back-users-member.html" class="menu--link active" title="會員資料管理" data-bs-toggle="tooltip"
                            data-bs-placement="right">
                            <i class="fa-solid fa-user-group menu--icon"></i>
                            <span class="menu--label">會員資料管理</span>
                        </a>
                    </li>
                    <li class="menu--item 9">
                        <a href="back-users-my-team.html" class="menu--link" title="後台帳號權限管理" data-bs-toggle="tooltip"
                            data-bs-placement="right">
                            <i class="fa-solid fa-user-secret menu--icon"></i>
                            <span class="menu--label">後台帳號及權限管理</span>
                        </a>
                    </li>
                    <li class="menu--item 7">
                        <!-- 缺網址 -->
                        <a href="#" class="menu--link" title="系統參數管理" data-bs-toggle="tooltip"
                            data-bs-placement="right">
                            <i class="fa-solid fa-gear menu--icon"></i>
                            <span class="menu--label ">系統參數管理</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Left Sidebar End -->
	<!-- Body Start -->
	<div class="wrapper wrapper-body">
		<div class="dashboard-body">
			<div class="container-fluid">
				<div class="row">
					<div class="col-md-12">
						<div class="d-main-title">
							<h3><i class="fa-solid fa-user-group me-3"></i>會員資訊管理</h3>
						</div>
					</div>
					<div class="col-md-12">
						<div class="conversion-setup">
							<div class="main-card mt-5">
								<div class="dashboard-wrap-content p-4">
									<div class="d-md-flex flex-wrap align-items-center">
										<!-- <div class="nav custom2-tabs btn-group" role="tablist">
											<button class="tab-link ms-0 active" data-bs-toggle="tab"
												data-bs-target="#overview-tab" type="button" role="tab"
												aria-controls="overview-tab" aria-selected="true">後台使用者</button>
											<button class="tab-link" data-bs-toggle="tab" data-bs-target="#role-tab"
												type="button" role="tab" aria-controls="role-tab"
												aria-selected="false">權限設定</button>
										</div> -->
										<div class="col-lg-3 col-md-6" style="width: 100px; ">
											<select class="selectpicker selectValue">
												<option value="1">啟用中</option>
												<option value="2">停用中</option>
												<option value="0">未驗證</option>
											</select>
										</div>
										<div style="width: 50px; margin-left: 550px;">
											<div class="form-group">
												<div class="relative-input position-relative">
													<input class="form-control h_40" id="search" type="text"
														placeholder="搜尋會員..." value="">
													<i class="uil uil-search"></i>
												</div>
											</div>
										</div>
										<!-- <div class="rs ms-auto mt_r4">
											<button class="main-btn btn-hover h_40 w-100" data-bs-toggle="modal"
												data-bs-target="#inviteTeamModal">新增後台使用者</button>
										</div> -->
									</div>
								</div>
							</div>
							<div class="tab-content">
								<div class="tab-pane fade active show" id="overview-tab" role="tabpanel">
									<div class="table-card mt-4">
										<div class="main-table">
											<div class="table-responsive">
												<table class="table">
													<thead class="thead-dark">
														<tr>
															<th scope="col">姓名</th>
															<th scope="col">Email帳號</th>
															<th scope="col">生日</th>
															<th scope="col">性別</th>
															<th scope="col">聯絡電話</th>
															<th scope="col">地址</th>
															<th scope="col">編輯</th>
															<th scope="col" id="auth">停權</th>
														</tr>
													</thead>
													<tbody>
														<tr>
															<!-- 表格內容 -->
														</tr>
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Body End -->

	<script src="js/vertical-responsive-menu.min.js"></script>
	<script src="js/jquery-3.6.0.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="vendor/OwlCarousel/owl.carousel.js"></script>
	<script src="vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
	<script src="js/custom.js"></script>
	<script src="js/datepicker.min.js"></script>
	<script src="js/i18n/datepicker.en.js"></script>
	<script src="js/night-mode.js"></script>
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
	<!-- Kai  backuserData -->
    <script src="js/backuserData.js"></script>

</body>
<script>
	const selectElement = document.querySelector('.selectValue');
	fetch('./member/ga')
		.then(response => response.json())
		.then(data => {
			const table = document.querySelector('.table tbody');
			data.forEach(member => {
				const tr = document.createElement("tr");
				function showMember() {
					const option = selectElement.options[selectElement.selectedIndex];
					const selectValue = option.value;    //選單的value
					console.log(selectValue);
					//↓以下為改變停用選單的th內容改成啟用
					const auth = document.querySelector("#auth");
					if (selectValue === "2") {
						auth.textContent = "啟用";
					} else {
						auth.textContent = "停權";
					}

					if (selectValue === `${member.memberstatus}`) {
						tr.innerHTML = `
							<td><input type="text" name="mname" class="member" id="${member.memberno}" value="${member.mname}"></td>
							<td><input name="memail" class="email allInput" id="${member.memberno}-email" value="${member.memail}" readonly></td>
							<td><input type="date" class="birth allInput" name="birth" id="${member.memberno}-birth" value="${member.birth}" readonly></td>
							<td>
								<select class="allInput" name="gender" id="mySelect-${member.memberno}" disabled>
									<option value="0" ${member.gender === 0 ? "selected" : ""}>不便透露</option>
									<option value="1" ${member.gender === 1 ? "selected" : ""}>男</option>
									<option value="2" ${member.gender === 2 ? "selected" : ""}>女</option>
								</select>

							</td>
							<td><input name="mcell" class="phone allInput" id="${member.mcell}" value="${member.mcell}" readonly></td>
							<td><input name="address" class="address allInput" id="${member.memberno}-address" value="${member.address}" readonly></td>
							<td><input type="image" id="edit-${member.memberno}" class="editbutton" img src="images/edit.png"></td>
							<td><span id="auth-${member.memberno}" class="action-btn "><i class="fa-solid fa-lock"></i></span></td>
							`
						table.appendChild(tr);

						//↓以下為編輯功能按鈕製作
						const editbutton = document.querySelector(`#edit-${member.memberno}`);
						const authbutton = document.querySelector(`#auth-${member.memberno}`);
						const memail = document.getElementById(`${member.memberno}-email`);
						const birth = document.getElementById(`${member.memberno}-birth`);
						const gender = document.getElementById(`mySelect-${member.memberno}`);
						const mcell = document.getElementById(`${member.mcell}`);
						const address = document.getElementById(`${member.memberno}-address`);
						//讓未驗證會員的編輯和權限按鈕先消失
						if (`${member.memberstatus}` === "0") {
							editbutton.setAttribute("hidden", "true");
							authbutton.setAttribute("hidden", "true");
						} else {
							editbutton.removeAttribute("hidden");
							authbutton.removeAttribute("hidden");

						}
						//監聽編輯按鈕,讓按下的編輯按鈕的會員出現框線和可編輯,再按一下則是儲存
						editbutton.addEventListener("click", () => {
							if (gender.disabled) {
								gender.disabled = false;
								memail.removeAttribute("readonly");
								memail.className = "email";
								birth.removeAttribute("readonly");
								birth.className = "birth";
								mcell.removeAttribute("readonly");
								mcell.className = "phone";
								address.removeAttribute("readonly");
								address.className = "address";
							} else {
								gender.disabled = true;
								memail.setAttribute("readonly", "readonly");
								memail.className = "allInput email";
								birth.setAttribute("readonly", "readonly");
								birth.className = "allInput birth";
								mcell.setAttribute("readonly", "readonly");
								mcell.className = "allInput phone";
								address.setAttribute("readonly", "readonly");
								address.className = "allInput address";
								//編輯內容儲存
								const updateMember = {
									memberno: member.memberno,
									mname: $(`#${member.memberno}`).val(),
									memail: $(`#${member.memberno}-email`).val(),
									birth: $(`#${member.memberno}-birth`).val(),
									gender: $(`#mySelect-${member.memberno}`).val(),
									mcell: $(`#${member.mcell}`).val(),
									mphone: member.mphone,
									address: $(`#${member.memberno}-address`).val()
								}
								fetch(`member/${member.memberno}`, {
									method: "POST",
									headers: { "Content-Type": "application/json" },
									body: JSON.stringify(updateMember)
								}).then(response => {
									if (response.ok) {
										return response.json();
									} else {
										return response.json().then(errors => {
											let errorMessages = Object.values(errors).join("<br>");
											throw new Error(errorMessages);
										});
									}
								})
									.then(success => {
										swal("修改成功!", "您已經更改了會員資料了", "success");
									})
									.catch(error => {
										console.error("Error:", error);
										swal("修改失敗!", error.message.replace(/<br>/g, '\n'), "error")
											.then(() => {
												$(`#${member.memberno}`).val(`${member.mname}`)
												$(`#${member.memberno}-email`).val(`${member.memail}`)
												$(`#${member.memberno}-birth`).val(`${member.birth}`)
												$(`#mySelect-${member.memberno}`).val(`${member.gender}`)
												$(`#${member.mcell}`).val(`${member.mcell}`)
												$(`#${member.memberno}-address`).val(`${member.address}`)
											});
									});
							}

						})

						//以下為權限功能按鈕製作監聽權限按鈕
						authbutton.addEventListener("click", () => {
							fetch(`member/${member.memberno}/auth`, {
								method: "POST"
							}).then(response => response.json())
								.then(success => {
									if (`${member.memberstatus}` === "1") {
										swal("停權成功!", "您已經更改了會員的權限資料了", "warning")
											.then(() => {
												member.memberstatus = 2;
												tr.remove();
											})
									} else {
										swal("啟用成功!", "您已經更改了會員的權限資料了", "success")
											.then(() => {
												member.memberstatus = 1;
												tr.remove();
											})
									}

								})
								.catch(error => console.error("Error:", error));

						})
					}

				}

				showMember();
				selectElement.addEventListener("change", () => {
					tr.remove();
					showMember();

				})
			})
		}).catch(error => console.error(error));

	// 當輸入框改變時觸發搜尋
	$("#search").keyup(function () {
		var searchValue = $("#search").val().toLowerCase();
		$("tbody tr").filter(function () {
			//這邊filter會篩選所有value跟searchValue相符合的input
			var trInputValue = $(this).find("input").filter(function () {
				return $(this).val().toLowerCase().indexOf(searchValue) > -1;
			});

			// 如果tr底下 所有文字內容有跟searchValue相符合,textMatches 就會等於 true
			var trText = $(this).text().toLowerCase().indexOf(searchValue) > -1;


			var selectMatches = $(this).find("select").children("option:selected").filter(function () {
				return $(this).text().toLowerCase().indexOf(searchValue) > -1;
			});

			// 如果有符合條件的input會顯示true,不符合就為false,  toggle(true)→顯示  toggle(false)→隱藏
			$(this).toggle(trInputValue.length > 0 || trText || selectMatches.length > 0);
		});
	});
</script>

</html>