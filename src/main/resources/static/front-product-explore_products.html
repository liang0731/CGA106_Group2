<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, shrink-to-fit=9">
	<meta name="description" content="Gambolthemes">
	<meta name="author" content="Gambolthemes">
	<title>瀏覽商品</title>

	<!-- Favicon Icon -->
	<link rel="icon" type="image/png" href="images/ezTicket.png">

	<!-- Stylesheets -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
		rel="stylesheet">
	<link href='vendor/unicons-2.0.1/css/unicons.css' rel='stylesheet'>
	<link href="css/style.css" rel="stylesheet">
	<link href="css/responsive.css" rel="stylesheet">
	<link href="css/night-mode.css" rel="stylesheet">

	<!-- Vendor Stylesheets -->
	<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
	<link href="vendor/OwlCarousel/assets/owl.carousel.css" rel="stylesheet">
	<link href="vendor/OwlCarousel/assets/owl.theme.default.min.css" rel="stylesheet">
	<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">

	<style>
		.main-btn {
			font-size: 16px;
			color: #fff;
			font-weight: 400;
			text-align: center;
			background: #102743;
			height: 50px;
			display: inline-block;
			line-height: 49px;
			padding: 0 23px;
			border-radius: 3px;
			border: 1px solid #102743;
		}
	</style>
</head>

<body class="d-flex flex-column h-100">
	<!-- Header Start-->
	<header class="header">
		<div class="header-inner">
			<nav
				class="navbar navbar-expand-lg bg-barren barren-head navbar fixed-top justify-content-sm-start pt-0 pb-0">
				<div class="container">
					<button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
						data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
						<span class="navbar-toggler-icon">
							<i class="fa-solid fa-bars"></i>
						</span>
					</button>
					<a class="navbar-brand order-1 order-lg-0 ml-lg-0 ml-2 me-auto" href="index.html">
						<div class="res-main-logo">
							<img src="images/ezTicket-icon.svg" alt="">
						</div>
						<div class="main-logo" id="logo">
							<img src="images/ezTicket.svg" alt="">
							<img class="logo-inverse" src="images/dark-logo.svg" alt="">
						</div>
					</a>
					<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar"
						aria-labelledby="offcanvasNavbarLabel">
						<div class="offcanvas-header">
							<div class="offcanvas-logo" id="offcanvasNavbarLabel">
								<img src="images/ezTicket-icon.svg" alt="">
							</div>
							<button type="button" class="close-btn" data-bs-dismiss="offcanvas" aria-label="Close">
								<i class="fa-solid fa-xmark"></i>
							</button>
						</div>
						<div class="offcanvas-body">
							<ul class="navbar-nav justify-content-end flex-grow-1 pe_5">
								<li class="nav-item">
									<a class="nav-link active" aria-current="page" href="index.html">首頁</a>
								</li>
								<li class="nav-item dropdown">
									<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
										aria-expanded="false">
										探索活動
									</a>
									<ul class="dropdown-menu dropdown-submenu">
										<li><a class="dropdown-item" href="explore_events.html">探索活動</a></li>
										<li><a class="dropdown-item" href="#">展覽</a></li>
										<li><a class="dropdown-item" href="#">演唱會</a></li>
										<li><a class="dropdown-item" href="#">音樂劇</a></li>
									</ul>
								</li>
								<li class="nav-item dropdown">
									<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
										aria-expanded="false">
										探索周邊
									</a>
									<ul class="dropdown-menu dropdown-submenu">
										<li><a class="dropdown-item" href="front-product-explore_products.html">探索商品</a>
										</li>
										<li><a class="dropdown-item" href="#">演唱會聯名</a></li>
										<li><a class="dropdown-item" href="#">Youtuber聯名</a>
										</li>
										<li><a class="dropdown-item" href="#">展覽聯名</a></li>
									</ul>
								</li>

								<li class="nav-item dropdown">
									<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
										aria-expanded="false">
										幫助中心
									</a>
									<ul class="dropdown-menu dropdown-submenu">
										<li><a class="dropdown-item" href="#">常見問題</a></li>
										<li><a class="dropdown-item" href="#">線上客服</a></li>
										<li><a class="dropdown-item" href="#">聯絡我們</a></li>
									</ul>
								</li>
								<li class="nav-item">
									<a class="nav-link active" aria-current="page" href="#"
										style="color:black !important">最新消息</a>
								</li>
								
							</ul>
						</div>
						<div class="offcanvas-footer">
							<div class="offcanvas-social">
								<h5>Follow Us</h5>
								<ul class="social-links">
									<li><a href="#" class="social-link"><i class="fab fa-facebook-square"></i></a>
									<li><a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
									<li><a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
									<li><a href="#" class="social-link"><i class="fab fa-linkedin-in"></i></a>
									<li><a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
								</ul>
							</div>
						</div>
					</div>
					<div class="right-header order-2">
						<ul class="align-self-stretch">
							<li>
								<a href="explore_events.html" class="create-btn btn-hover">
									<i class="fa-solid fa-calendar-days"></i>
									<span>活動訂票</span>
								</a>
								<a href="front-product-explore_products.html" class="create-btn btn-hover">
									<i class="fa-sharp fa-solid fa-bag-shopping"></i>
									<span>聯名商品</span>
								</a>
							</li>
							<li>

							</li>
							<li class="dropdown account-dropdown">
								<a href="#" class="account-link" role="button" id="accountClick"
									data-bs-auto-close="outside" data-bs-toggle="dropdown" aria-expanded="false">
									<img src="images/profile-imgs/img-13.jpg" alt="">
									<i class="fas fa-caret-down arrow-icon"></i>
								</a>
								<ul class="dropdown-menu dropdown-menu-account dropdown-menu-end"
									aria-labelledby="accountClick">
									<li>
										<div class="dropdown-account-header">
											<div class="account-holder-avatar">
												<img class="D-mimg" src="images/profile-imgs/img-13.jpg" alt="">
											</div>
											<h5 class="D-mname">會員名稱</h5>
											<p class="D-memail">johndoe@example.com</p>
										</div>
									</li>
									<li class="profile-link">
										<a class="dropdown-item pe-5" href="front-users-member-profile.html">會員資訊</a>
										<a class="dropdown-item pe-5" href="front-users-mem-sign-in.html">登入</a>
										<a class="dropdown-item pe-5" href="front-users-sign-up.html">註冊</a>
										<a class="dropdown-item pe-5" href="front-users-forgot-pwd.html">忘記密碼</a>

									</li>
								</ul>
							</li>
							<li>
								<div class="night_mode_switch__btn">
									<div id="night-mode" class="fas fa-moon fa-sun"></div>
								</div>
							</li>

							<li class="dropdown account-dropdown">
								<a href="front-product-shopping_cart.html" class="account-link">
									<div id="cart">
										<img src="images/profile-imgs/cart2.jpg">
										<span class="badge" style="color:#102743 ;">0</span>
									</div>
								</a>
							</li>

						</ul>
					</div>
				</div>
			</nav>
			<div class="overlay"></div>
		</div>
	</header>
	<!-- Header End-->
	<!-- Body Start-->
	<div class="wrapper">
		<div class="hero-banner">
			<div class="container">
				<div class="row justify-content-center">
					<div class="col-xl-8 col-lg-8 col-md-10">
						<div class="hero-banner-content">
							<h2>Discover Events For All The Things You Love</h2>
							<div class="search-form main-form">
								<div class="row g-3">
									<div class="col-lg-5 col-md-12">
										<div class="form-group search-category">
											<select class="selectpicker" data-width="100%" data-size="5"
												id="pclassSelector" name="pclassno">
												<option value="" data-icon="fa-solid fa-tower-broadcast" selected>類別選擇
												</option>
												<!-- 類別選單顯示開始 -->
												<!-- <option value="online_events" data-icon="fa-solid fa-video">Online
													Events</option>
												<option value="venue_events" data-icon="fa-solid fa-location-dot">Venue
													Events</option> -->
												<!-- 類別選單顯示結束 -->
											</select>
										</div>
									</div>
									<div class="col-lg-5 col-md-12">
										<div class="form-group">
											<input id="pnameSearch" class="form-control h_40" type="text"
												placeholder="搜尋商品" value="" name="pname">
											<!-- <select class="selectpicker" data-width="100%" data-size="5"
												data-live-search="true">
												<option value="01" selected>All</option>
												<option value="02">Arts</option>
												<option value="03">Business</option>
												<option value="04">Coaching and Consulting</option>
												<option value="05">Community and Culture</option>
												<option value="06">Education and Training</option>
												<option value="07">Family and Friends</option>
												<option value="08">Fashion and Beauty</option>
												<option value="09">Film and Entertainment</option>
												<option value="10">Food and Drink</option>
												<option value="11">Free</option>
												<option value="12">Health and Wellbeing</option>
												<option value="13">Hobbies and Interest</option>
												<option value="14">Music and Theater</option>
												<option value="15">Religion and Spirituality</option>
												<option value="16">Science and Technology</option>
												<option value="17">Sports and Fitness</option>
												<option value="18">Travel and Outdoor</option>
												<option value="19">Visual Arts</option>
											</select> -->
										</div>
									</div>
									<!-- 將按鈕刪除 -->
									<!-- <div class="col-lg-2 col-md-12">
										<a href="#" class="main-btn btn-hover w-100">Find</a>
									</div> -->
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="explore-events p-80">
			<div class="container">
				<div class="row">
					<div class="col-xl-12 col-lg-12 col-md-12">
						<div class="event-filter-items">
							<div class="featured-controls">
								<div class="filter-tag">
									<a href="explore_events_by_date.html" class="active">All</a> <a
										href="explore_events_by_date.html">Today</a> <a
										href="explore_events_by_date.html">Tomorrow</a> <a
										href="explore_events_by_date.html">This Week</a> <a
										href="explore_events_by_date.html">This Weekend</a> <a
										href="explore_events_by_date.html">Next Week</a> <a
										href="explore_events_by_date.html">Next Weekend</a> <a
										href="explore_events_by_date.html">This Month</a> <a
										href="explore_events_by_date.html">Next Month</a> <a
										href="explore_events_by_date.html">This Year</a> <a
										href="explore_events_by_date.html">Next Year</a>
								</div>
								<div class="controls">
									<button type="button" class="control" data-filter="all">All</button>
									<button type="button" class="control" data-filter=".arts">Arts</button>
									<button type="button" class="control" data-filter=".business">Business</button>
									<button type="button" class="control" data-filter=".concert">Concert</button>
									<button type="button" class="control" data-filter=".workshops">Workshops</button>
									<button type="button" class="control" data-filter=".coaching_consulting">Coaching
										and
										Consulting</button>
									<button type="button" class="control" data-filter=".health_Wellness">Health and
										Wellbeing</button>
									<button type="button" class="control" data-filter=".volunteer">Volunteer</button>
									<button type="button" class="control" data-filter=".sports">Sports</button>
									<button type="button" class="control" data-filter=".free">Free</button>
								</div>
								<div class="row" data-ref="event-filter-content" id="productList">
								</div>
								<div class="browse-btn">
									<a href="#" class="main-btn btn-hover ">See More</a>
								</div>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Body End-->
		<!-- Footer Start-->
		<footer class="footer mt-auto">
			<div class="footer-top">
				<div class="container">
					<div class="row">
						<div class="col-lg-3 col-md-6">
							<div class="footer-content">
								<h4>Company</h4>
								<ul class="footer-link-list">
									<li><a href="about_us.html" class="footer-link">About
											Us</a></li>
									<li><a href="help_center.html" class="footer-link">Help
											Center</a></li>
									<li><a href="faq.html" class="footer-link">FAQ</a></li>
									<li><a href="contact_us.html" class="footer-link">Contact
											Us</a></li>
								</ul>
							</div>
						</div>
						<div class="col-lg-3 col-md-6">
							<div class="footer-content">
								<h4>Useful Links</h4>
								<ul class="footer-link-list">
									<li><a href="create.html" class="footer-link">Create
											Event</a></li>
									<li><a href="sell_tickets_online.html" class="footer-link">Sell
											Tickets Online</a></li>
									<li><a href="privacy_policy.html" class="footer-link">Privacy
											Policy</a></li>
									<li><a href="term_and_conditions.html" class="footer-link">Terms
											& Conditions</a></li>
								</ul>
							</div>
						</div>
						<div class="col-lg-3 col-md-6">
							<div class="footer-content">
								<h4>Resources</h4>
								<ul class="footer-link-list">
									<li><a href="pricing.html" class="footer-link">Pricing</a></li>
									<li><a href="our_blog.html" class="footer-link">Blog</a></li>
									<li><a href="refer_a_friend.html" class="footer-link">Refer
											a Friend</a></li>
								</ul>
							</div>
						</div>
						<div class="col-lg-3 col-md-6">
							<div class="footer-content">
								<h4>Follow Us</h4>
								<ul class="social-links">
									<li><a href="#" class="social-link"><i class="fab fa-facebook-square"></i></a>
									<li><a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
									<li><a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
									<li><a href="#" class="social-link"><i class="fab fa-linkedin-in"></i></a>
									<li><a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
								</ul>
							</div>
							<div class="footer-content">
								<h4>Download Mobile App</h4>
								<div class="download-app-link">
									<a href="#" class="download-btn"><img src="images/app-store.png" alt=""></a> <a
										href="#" class="download-btn"><img src="images/google-play.png" alt=""></a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="footer-bottom">
				<div class="container">
					<div class="row">
						<div class="col-12">
							<div class="footer-copyright-text">
								<p class="mb-0">
									© 2022, <strong>Barren</strong>. All rights reserved. Powered by
									Gambolthemes
								</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</footer>
		<!-- Footer End-->


		<script src="js/jquery-3.6.0.min.js"></script>
		<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
		<script src="vendor/OwlCarousel/owl.carousel.js"></script>
		<script src="vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
		<script src="vendor/mixitup/dist/mixitup.min.js"></script>
		<script src="js/custom.js"></script>
		<script src="js/night-mode.js"></script>
		<script>
			var containerEl = document.querySelector('[data-ref~="event-filter-content"]');

			var mixer = mixitup(containerEl, {
				selectors: {
					target: '[data-ref~="mixitup-target"]'
				}
			});
		</script>

		<script>
			//類別從資料庫帶入
			fetch("PclassController", {
				method: "POST",
				body: new URLSearchParams({ 'action': "productClassList" })
			}).then(resp => resp.json())
				.then(list => {
					for (let item of list) {
						$('#pclassSelector').append(`<option value=${item.pclassno}>${item.pclassname}</option>`);
					}
				}).then(function () {
					$('.selectpicker').selectpicker('refresh');
				})
			
		</script>

		<script>

			// 當網頁載入時先呈現所有商品
			$(document).ready(() => {
				fetchProductList();
			});

			function fetchProductList() {

				//為什麼加在這邊就不能顯示?
				// //類別從資料庫帶入
				// fetch("PclassController", {
				// 	method: "POST",
				// 	body: new URLSearchParams({ 'action': "productClassList" })
				// }).then(resp => resp.json())
				// 	.then(list => {
				// 		for (let item of list) {
				// 			$('#pclassSelector').append(`<option value=${item.pclassno}>${item.pclassname}</option>`);
				// 		}
				// 	}).then(function () {
				// 		$('.selectpicker').selectpicker('refresh');
				// 	})

				//?	
				fetch('ProductInfoServlet', {
					method: 'POST',
					body: new URLSearchParams({
						'action': "availableProductList"
					})
				}).then(resp => resp.json())
					.then(list => {
						displayProducts(list);
					})

				//商品名稱搜尋
				$("#pnameSearch").keypress(function () {
					fetch("ProductInfoServlet", {
						method: 'POST',
						body: new URLSearchParams({
							'pname': $("[name='pname']").val(),
							'pclassno': $("[name='pclassno']").val(),
							'action': "availableProductList"
						})
					}).then(resp => resp.json())
						.then(list => {
							console.log(list);
							displayProducts(list);
						})
				})

				//商品類別搜尋
				$('#pclassSelector').change(function () {
					fetch('ProductInfoServlet', {
						method: "POST",
						headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
						body: new URLSearchParams({
							// var title = $('button[data-id="pclassSelector"]').attr('title');
							'pname': $("[name='pname']").val(),
							'pclassno': $("[name='pclassno']").val(),
							'action': "availableProductList"
						}),
					}).then(resp => resp.json())
						.then(list => {
							displayProducts(list);
						})
				})


			}

			function displayProducts(list) {
				$('#productList').empty();

				for (let item of list) {
					let image = item.pimgts && item.pimgts[0] && item.pimgts[0].pimgno;
					if (image === undefined) { image = 70001; }

					$('#productList').append(`<div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mix arts concert workshops volunteer sports health_Wellness" data-ref="mixitup-target">
			<div class="main-card mt-4">
				<div class="event-thumbnail">
					<a href="front-product-product_detail.html?productno=${item.productno}" class="thumbnail-img">
						<img src="ProductImg?pimgno=${image}" alt="">

					</a>
					<span id="followProduct_${item.productno}" class="bookmark-icon" title="Bookmark" onclick="followProduct(${item.productno})"></span>
				</div>
				<div class="event-content">
					<a href="front-product-product_detail.html?productno=${item.productno}" class="event-title">${item.pname}</a>
					<div class="duration-price-remaining">
						<span class="duration-price" style="text-decoration: line-through">${item.pprice}</span>
						<span class="duration-price" style="font-size: 20px;">${item.pspecialprice}</span>
						<span class="remaining" id="rateAvg${item.productno}"><i class="fa fa-star" aria-hidden="true"></i></span>
					</div>
				</div>
				<div class="event-footer">
						<a onclick="buyNow(${item.productno})" class="main-btn btn-hover w-45" style="width:48%;">Buy Now</a>
						<button type="button" class="main-btn btn-hover w-45" style="width:48%;" onclick="addCart(${item.productno})" id="product-incart"><i class="fa-solid fa-cart-shopping"></i></button>
				</div>
			</div>
		</div>`);
					if (item.prateqty < 1) {
						$("#rateAvg" + item.productno).text('尚無評星')
					}
					else if (item.prateqty >= 1) {
						$("#rateAvg" + item.productno).text((item.pratetotal / item.prateqty).toFixed(1)).append(`&nbsp;<i class="fa-solid fa-star" style="color: #ffad21!important;"></i>`);
					}
				}

				// Document load 的時候顯示追蹤過的商品，$(`#followProduct_${i}`) 要新增在空讚的圖片中
				$.ajax({
					url: "FollowproductController",
					cache: false,
					async: false,
					type: 'POST',
					dataType: "json",
					data: {
						"action": "getFollowProductList",
						// "memberno": info.memberno,
					},
					success: function (jsondata) {
						// console.log(jsondata);
						for (let item of jsondata) {
							// console.log(item.followproductPK.productno);
							$(`#followProduct_${item.followproductPK.productno}`).addClass("bookmarked");
						}
					}

				})
			}
		</script>
		<script src="js/my_porder.js"></script>
		<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

		<script>
			//新增商品追蹤
			//會員不知道該怎麼辦先寫死
			const info = {
				// memberNo: 85346
			}

			function followProduct(productno) {

				const btnClass = event.target.className;

			if (btnClass === 'bookmark-icon') {

				fetch("FollowproductController", {
					method: "POST",
					body: new URLSearchParams({
						'productno': productno,
						'action': "addOneProductFollow"
					})
				}).then(resp => resp.json())
					.then(item => {
						console.log(item);
						if (item) {
							console.log(productno);
							$('#followProduct_' + productno).addClass("bookmarked");
							
						}
					})
			} else if (btnClass === 'bookmark-icon bookmarked') {

				fetch("FollowproductController", {
					method: "POST",
					body: new URLSearchParams({
						'productno': productno,
						'action': "unfollowOneProduct"
					})
				}).then(resp => resp.json())
					.then(item => {
						console.log(item);
						if (item) {
							console.log(productno);
							$('#followProduct_' + productno).removeClass("bookmarked");
						}
					})
			}
			}
		</script>
</body>

</html>