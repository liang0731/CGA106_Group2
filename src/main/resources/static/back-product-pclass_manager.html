<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, shrink-to-fit=9">
	<meta name="description" content="Gambolthemes">
	<meta name="author" content="Gambolthemes">
	<title>商品類別管理</title>

	<!-- Favicon Icon -->
	<link rel="icon" type="image/png" href="images/ezTicket.png">

	<!-- Stylesheets -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
		rel="stylesheet">
	<link href='vendor/unicons-2.0.1/css/unicons.css' rel='stylesheet'>
	<link href="css/style.css" rel="stylesheet">
	<link href="css/vertical-responsive-menu.min.css" rel="stylesheet">
	<link href="css/responsive.css" rel="stylesheet">
	<link href="css/night-mode.css" rel="stylesheet">

	<!-- Vendor Stylesheets -->
	<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
	<link href="vendor/OwlCarousel/assets/owl.carousel.css" rel="stylesheet">
	<link href="vendor/OwlCarousel/assets/owl.theme.default.min.css" rel="stylesheet">
	<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">

	<!-- 將文字縮成刪節號 -->
	<style>
		.ellipsis {
			overflow: hidden;
			white-space: nowrap;
			text-overflow: ellipsis;
		}
	</style>
</head>

<body class="d-flex flex-column h-100">
	<!-- Header Start-->
	<header class="header">
		<div class="header-inner">
			<nav
				class="navbar navbar-expand-lg bg-barren barren-head navbar fixed-top justify-content-sm-start pt-0 pb-0 ps-lg-0 pe-2">
				<div class="container-fluid ps-0">
					<button type="button" id="toggleMenu" class="toggle_menu">
						<i class="fa-solid fa-bars-staggered"></i>
					</button>
					<button id="collapse_menu" class="collapse_menu me-4">
						<i class="fa-solid fa-bars collapse_menu--icon "></i>
						<span class="collapse_menu--label"></span>
					</button>
					<button class="navbar-toggler order-3 ms-2 pe-0" type="button" data-bs-toggle="offcanvas"
						data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
						<span class="navbar-toggler-icon">
							<i class="fa-solid fa-bars"></i>
						</span>
					</button>
					<a class="navbar-brand order-1 order-lg-0 ml-lg-0 ml-2 me-auto" href="index.html">
						<div class="res-main-logo">
							<img src="images/ezTicket-icon.svg" alt="">
						</div>
						<div class="main-logo" id="logo">
							<img src="images/ezTicket.svg" alt="">
							<img class="logo-inverse" src="images/dark-logo.svg" alt="">
						</div>
					</a>
					<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar"
						aria-labelledby="offcanvasNavbarLabel">
						<div class="offcanvas-header">
							<div class="offcanvas-logo" id="offcanvasNavbarLabel">
								<img src="images/ezTicket-icon.svg" alt="">
							</div>
							<button type="button" class="close-btn" data-bs-dismiss="offcanvas" aria-label="Close">
								<i class="fa-solid fa-xmark"></i>
							</button>
						</div>
						<div class="offcanvas-body">
							<div class="offcanvas-top-area">
								<div class="create-bg">
									<a href="create.html" class="offcanvas-create-btn">
										<i class="fa-solid fa-calendar-days"></i>
										<span>Create Event</span>
									</a>
								</div>
							</div>
							<ul class="navbar-nav justify-content-end flex-grow-1 pe_5">
								<li class="nav-item">
									<a class="nav-link" href="organiser_profile_view.html">
										<i class="fa-solid fa-right-left me-2"></i>My Home
									</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="explore_events.html">
										<i class="fa-solid fa-compass me-2"></i>Explore Events
									</a>
								</li>
							</ul>
						</div>
						<div class="offcanvas-footer">
							<div class="offcanvas-social">
								<h5>Follow Us</h5>
								<ul class="social-links">
									<li><a href="#" class="social-link"><i class="fab fa-facebook-square"></i></a>
									</li>
									<li><a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
									</li>
									<li><a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
									</li>
									<li><a href="#" class="social-link"><i class="fab fa-linkedin-in"></i></a>
									</li>
									<li><a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
									</li>
								</ul>
							</div>
						</div>
					</div>
					<div class="right-header order-2">
						<ul class="align-self-stretch">
							<li>
								<a href="create.html" class="create-btn btn-hover">
									<i class="fa-solid fa-calendar-days"></i>
									<span>Create Event</span>
								</a>
							</li>
							<li class="dropdown account-dropdown order-3">
								<a href="#" class="account-link" role="button" id="accountClick"
									data-bs-auto-close="outside" data-bs-toggle="dropdown" aria-expanded="false">
									<img src="images/profile-imgs/img-13.jpg" alt="">
									<i class="fas fa-caret-down arrow-icon"></i>
								</a>
								<ul class="dropdown-menu dropdown-menu-account dropdown-menu-end"
									aria-labelledby="accountClick">
									<li>
										<div class="dropdown-account-header">
											<div class="account-holder-avatar">
												<img src="images/profile-imgs/img-13.jpg" alt="">
											</div>
											<h5>John Doe</h5>
											<p>johndoe@example.com</p>
										</div>
									</li>
									<li class="profile-link">
										<a href="organiser_profile_view.html" class="link-item">My Profile</a>
										<a href="sign_in.html" class="link-item">Sign Out</a>
									</li>
								</ul>
							</li>
							<li>
								<div class="night_mode_switch__btn">
									<div id="night-mode" class="fas fa-moon fa-sun"></div>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</nav>
			<div class="overlay"></div>
		</div>
	</header>
	<!-- Header End-->
	<!-- Left Sidebar Start -->
	<nav class="vertical_nav">
		<div class="left_section menu_left" id="js-menu">
			<div class="left_section">
				<ul>
					<li class="menu--item">
						<a href="my_organisation_dashboard.html" class="menu--link" title="Dashboard"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-gauge menu--icon"></i>
							<span class="menu--label">Dashboard</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="my_organisation_dashboard_events.html" class="menu--link" title="Events"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-calendar-days menu--icon"></i>
							<span class="menu--label">Events</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="my_organisation_dashboard_promotion.html" class="menu--link" title="Promotion"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-rectangle-ad menu--icon"></i>
							<span class="menu--label">Promotion</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="my_organisation_dashboard_contact_lists.html" class="menu--link" title="Contact List"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-regular fa-address-card menu--icon"></i>
							<span class="menu--label">Contact List</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="my_organisation_dashboard_payout.html" class="menu--link" title="Payouts"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-credit-card menu--icon"></i>
							<span class="menu--label">Payouts</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="my_organisation_dashboard_reports.html" class="menu--link active" title="Reports"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-chart-pie menu--icon"></i>
							<span class="menu--label">Reports</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="my_organisation_dashboard_subscription.html" class="menu--link" title="Subscription"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-bahai menu--icon"></i>
							<span class="menu--label">Subscription</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="my_organisation_dashboard_conversion_setup.html" class="menu--link"
							title="Conversion Setup" data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-square-plus menu--icon"></i>
							<span class="menu--label">Conversion Setup</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="my_organisation_dashboard_about.html" class="menu--link" title="About"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-circle-info menu--icon"></i>
							<span class="menu--label">About</span>
						</a>
					</li>
					<li class="menu--item">
						<a href="my_organisation_dashboard_my_team.html" class="menu--link team-lock" title="My Team"
							data-bs-toggle="tooltip" data-bs-placement="right">
							<i class="fa-solid fa-user-group menu--icon"></i>
							<span class="menu--label">My Team</span>
						</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<!-- Left Sidebar End -->
	<!-- Body Start -->
	<div class="wrapper wrapper-body">
		<div class="dashboard-body">
			<div class="container-fluid">
				<div class="row">
					<div class="col-md-12">
						<div class="d-main-title">
							<h3>
								商品類別管理
							</h3>
						</div>
					</div>
					<div class="col-md-12">
						<div class="main-card mt-5">
							<div class="dashboard-wrap-content p-4">
								<!-- <div class="nav custom2-tabs btn-group" role="tablist">
									<button id="allCommentTab" class="tab-link ms-0 active" data-bs-toggle="tab"
										data-bs-target="#orders-tab" type="button" role="tab" aria-controls="orders-tab"
										aria-selected="true" onclick="fetchPcommentList()"><span
											class="total_event_counter">商品評論</span>
									</button>
									<button id="allReportTab" class="tab-link" data-bs-toggle="tab"
										data-bs-target="#tickets-tab" type="button" role="tab"
										aria-controls="tickets-tab" aria-selected="false"
										onclick="fetchPcommentRoportList()">受檢舉評論
									</button>
								</div> -->
								<button class="esv-btn me-2" data-bs-toggle="modal"
									data-bs-target="#inviteTeamModal_add">
									<div style="width: 200px; height: 50px;">
										<p class="ellipsis" style="font-weight: 500;
													color: #000 !important; line-height: 50px;">
											新增類別</p>
									</div>
								</button>
								<div class="d-md-flex flex-wrap align-items-center">
									<div class="dashboard-date-wrap mt-4">
										<div class="form-group">
											<div class="relative-input position-relative">
												<input id="pclassnameSearch" class="form-control h_40" type="text"
													placeholder="搜尋商品類別名稱" value="" name="pclass">
												<i class="uil uil-search"></i>
											</div>
										</div>
									</div>
									<!-- <div class="rs ms-auto mt-4 mt_r4" id="reload">
										<a href="#" class="pe-4 w-100 ps-4 text-center co-main-btn h_40 d-inline-block"
											onclick="refresh()">
											<i class="fa-solid fa-arrow-rotate-right me-3"></i>重新整理</a>
									</div> -->
								</div>
								<div class="main-form mt-4">
									<div class="row g-3">
										<!-- <div class="col-lg-3 col-md-6">
											<div class="form-group">
												<select id="showSelector" class="form-select" data-size="5"
													data-live-search="true" name="productno">
												</select>
											</div>
										</div> -->
										<!-- <div class="col-lg-3 col-md-6">
											<div class="form-group">
												<select id="statusSelector" name="pcommentstatus"
													class="form-select"></select> -->
										<!-- 評論狀態選單顯示 -->
										<!-- </div>
										</div> -->
									</div>
								</div>
							</div>
						</div>
						<div class="event-list">
							<div class="tab-content">
								<div class="tab-pane fade show active" id="orders-tab" role="tabpanel">
									<div class="table-card mt-4">
										<div class="main-table">
											<div class="table-responsive">
												<table class="table">
													<thead class="thead-dark">
														<tr>
															<th scope="col" style="width: 15%">類別編號</th>
															<th scope="col" style="width: 15%">類別名稱</th>
															<!-- <th scope="col" style="width: 15%">商品名稱</th>
															<th scope="col" style="width: 20%">評論內容</th>
															<th scope="col" style="width: 10%">評論星等</th>
															<th scope="col" style="width: 10%">評論讚數</th>
															<th scope="col" style="width: 15%">評論狀態</th> -->
														</tr>
													</thead>
													<tbody id="productClass">
														<!-- pclass顯示的位置 -->
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>

								<div class="tab-pane fade" id="tickets-tab" role="tabpanel">
									<div class="table-card mt-4">
										<div class="main-table">
											<div class="table-responsive">
												<table class="table">
													<thead class="thead-dark">
														<tr>
															<th scope="col" style="width: 15%">受評論日期</th>
															<th scope="col" style="width: 12.5%">檢舉者</th>
															<th scope="col" style="width: 12.5%">被檢舉者</th>
															<th scope="col" style="width: 10%">商品名稱</th>
															<th scope="col" style="width: 15%">檢舉原因</th>
															<th scope="col" style="width: 15%">評論內容</th>
															<th scope="col" style="width: 20%">處理狀態</th>
														</tr>
													</thead>
													<tbody id="productCommentReport">
														<!-- 檢舉評論頁面在這裡 -->
														<tr>
															<td>2022/05/31</td>
															<td>黃小藍</td>
															<td>張小美</td>
															<td>
																<!-- <a href="#" target="_blank"> -->
																<div style="width: 150px; height: 50px;">
																	<p class="ellipsis" style="font-weight: 500;
																		color: #000 !important; line-height: 50px;">
																		保時捷姊新歌演唱會</p>
																</div>
																<!-- </a> -->
															</td>
															<td>
																<button
																	style="border: none; background-color: transparent;"
																	data-bs-toggle="modal"
																	data-bs-target="#inviteTeamModal_bad">
																	<div style="width: 150px; height: 50px;">
																		<p class="ellipsis" style="font-weight: 500;
																		color: #000 !important; line-height: 50px;">
																			評論含有不當言詞或攻擊性的言論</p>
																	</div>
																</button>
															</td>
															<td>
																<button
																	style="border: none; background-color: transparent;"
																	data-bs-toggle="modal"
																	data-bs-target="#inviteTeamModal_bad">
																	<div style="width: 150px; height: 50px;">
																		<p class="ellipsis" style="font-weight: 500;
																		color: #000 !important; line-height: 50px;">
																			演唱會音效糟糕，歌手唱歌走音，讓人十分失望</p>
																	</div>
																</button>
															</td>
															<td><span class="status-circle green-circle"></span>已處理
																(不顯示)
															</td>
														</tr>
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Body End -->

	<!-- aria-labelledby="inviteTeamModalLabel" -->
	<!-- 新增類別內容開始-->
	<div class="modal fade" id="inviteTeamModal_add" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">新增類別</h5>
					<button type="button" class="close-model-btn" data-bs-dismiss="modal" aria-label="Close"><i
							class="uil uil-multiply"></i></button>
				</div>
				<div class="modal-body">
					<div class="model-content main-form">
						<input id="pcommentno" type="text" value="" style="display: none">
						<div class="form-group mt-30">
							<label for="pclassname" class="form-label">類別名稱：
								<span class="pclassnameErr" style="color: #DAA520"></span>
							</label>
							<input type="text" id="pclassname" class="form-textarea" onkeyup="confirm_exist(this.id)"
								style="height:20px"></input>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="co-main-btn min-width btn-hover h_40" data-bs-dismiss="modal">取消新增
					</button>
					<button type="button" class="main-btn min-width btn-hover h_40" data-bs-dismiss="modal"
						onclick="confirm_add()" id="confirm_add">確認新增
					</button>
				</div>
			</div>
		</div>
	</div>
	<!-- 新增類別內容結束-->
	<!-- 修改類別內容開始-->
	<div class="modal fade" id="inviteTeamModal_update" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">修改類別</h5>
					<button type="button" class="close-model-btn" data-bs-dismiss="modal" aria-label="Close"><i
							class="uil uil-multiply"></i></button>
				</div>
				<div class="modal-body">
					<div class="model-content main-form">
						<input id="pclassno" type="text" value="" style="display: none">
						<div class="form-group mt-30">
							<label class="form-label">原類別名稱：</label>
							<textarea id="pclassname_old" class="form-textarea" disabled></textarea>
						</div>
						<div class="form-group mt-30">
							<label class="form-label">新類別名稱：
								<span class="pclassnameErr" style="color: #DAA520"></span>
							</label>
							<textarea id="pclassname_new" class="form-textarea"
								onkeyup="confirm_exist(this.id)"></textarea>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="co-main-btn min-width btn-hover h_40" data-bs-dismiss="modal">取消修改
					</button>
					<button type="button" class="main-btn min-width btn-hover h_40" data-bs-dismiss="modal"
						onclick="confirm_update()" id="confirm_update">確認修改
					</button>
				</div>
			</div>
		</div>
	</div>
	<!-- 修改類別內容結束-->

	<!-- aria-labelledby="inviteTeamModalLabel" -->


	<script src="js/vertical-responsive-menu.min.js"></script>
	<script src="js/jquery-3.6.0.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="vendor/OwlCarousel/owl.carousel.js"></script>
	<script src="vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
	<script src="js/custom.js"></script>
	<script src="js/night-mode.js"></script>


	<script>

		// 當網頁載入時先呈現所有商品類別
		$(document).ready(() => {
			fetchPclassList();
		});


		//載入所有類別
		function fetchPclassList() {

			fetch('PclassController', {
				method: 'POST',
				body: new URLSearchParams({
					'action': "productClassList"
				})
			}).then(resp => resp.json())
				.then(list => {
					displayPclass(list);
				}).then(() =>{
					$("productClass")
				});
		}

		//查詢商品類別名稱
		$('#pclassnameSearch').keyup(function () {
			fetch('PclassController', {
				method: "POST",
				headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
				body: new URLSearchParams({
					'pclassname': $("[name='pclass']").val(),
					'action': "pclassnameSearch"
				})
			}).then(resp => resp.json())
				.then(list => {
					displayPclass(list);
				})
		})


		// 點擊單一評論並顯示
		function showcomment(commentno) {
			fetch('ProductCommentServlet', {
				method: 'POST',
				body: new URLSearchParams({
					'pcommentno': commentno,
					'action': "getOneproductComment"
				})
			}).then(resp => resp.json())
				.then(item => {
					console.log(item);
					//把前面有的值先清空避免吃到舊值
					$('#pcommentno').val("");
					$('#ccontent').text("");

					$('#pcommentno').val(item.pcommentno);
					$('#ccontent').text(item.pcommentcont);

					if (item.pcommentstatus === -1) {
						$("#cstatus>option[value='-1']").prop("selected", true);
					} else if (item.pcommentstatus === 0) {
						$("#cstatus>option[value='0']").prop("selected", true);
					} else {
						$("#cstatus>option[value='1']").prop("selected", true);

					}
				})
			return commentno;
		}

		// 新增商品類別
		function confirm_add() {

			// if(confirm_exist() === true){
			fetch('PclassController', {
				method: 'POST',
				body: new URLSearchParams({
					'pclassname': $('#pclassname').val(),
					'action': "addProductClass"
				})
			}).then((resp) => resp.json())
				.then((item) => {
					if (item) {
						fetchPclassList();
					} else
						alert("新增失敗,請再次新增類別");
				})
			// }

		}

		//顯示評論
		function displayPclass(list) {
			//避免更新單筆資料後render出現重複資料
			$('#productClass').html('');
			for (let item of list) {
				console.log(item);
				$('#productClass').append(`<tr>   
										<td>${item.pclassno}</td>
										<td><button name="${item.pclassno}"
											style="border: none; background-color: transparent;"
											data-bs-toggle="modal"
											data-bs-target="#inviteTeamModal_update" onclick="showpclass(this.name)">
											<div style="width: 150px; height: 50px;">
											<p class="ellipsis" style="font-weight: 500;color: #000 !important; line-height: 50px;">${item.pclassname}</p>
											</div>
											</button></td>
									    </tr>`);
			}

		}


		// 點擊單一類別名稱並顯示
		function showpclass(pclassno) {
			fetch('PclassController', {
				method: 'POST',
				body: new URLSearchParams({
					'pclassno': pclassno,
					'action': "getOneProductClass"
				})
			}).then(resp => resp.json())
				.then(item => {
					//把前面有的值先清空避免吃到舊值
					$('#pclassno').val("");
					$('#pclassname_old').text("");
					$('#pclassname_new').val("");

					$('#pclassno').val(item.pclassno);
					$('#pclassname_old').text(item.pclassname);

				})
			return pclassno;
		}


		// 修改單一類別名稱
		function confirm_update() {
			fetch('PclassController', {
				method: 'POST',
				body: new URLSearchParams({
					'pclassno': $('#pclassno').val(),
					'pclassname_new': $('#pclassname_new').val(),
					'action': "updateOneproductClass"
				})
			}).then((resp) => resp.json())
				.then((item) => {
					console.log(item);
					if (item) {
						fetchPclassList();
					} else
						alert("請重新檢查類別名稱");
				})
		}

		//確認類別不能新增重複商品
		function confirm_exist(id) {
			$(".pclassnameErr").empty();

			if (id === "pclassname") {
				fetch('PclassController', {
					method: 'POST',
					body: new URLSearchParams({
						'pclassname': $('#pclassname').val(),
						'action': "pclassnameComfirm"
					})
				}).then((resp) => resp.json())
					.then((list) => {
						console.log(list);
						if (list.length >= 1) {
							//新增類別時使用
							$(".pclassnameErr").html(`<i class="fa-sharp fa-solid fa-circle-exclamation"></i>商品類別名稱已重複，不可新增`);
							$("#confirm_add").prop('disabled', true);
							$("#confirm_add").attr('style', 'background-color:gray');
							//修改類別時使用
						} else {
							$("#pclassnameErr").html('');
							$("#confirm_add").prop('disabled', false);
							$("#confirm_add").removeAttr('style');
							return true;
						}
					})
			}
			if (id === "pclassname_new") {
				fetch('PclassController', {
					method: 'POST',
					body: new URLSearchParams({
						'pclassname': $('#pclassname_new').val(),
						'action': "pclassnameComfirm"
					})
				}).then((resp) => resp.json())
					.then((list) => {
						console.log(list);
						if (list.length >= 1) {
							//新增類別時使用
							$(".pclassnameErr").html(`<i class="fa-sharp fa-solid fa-circle-exclamation"></i>商品類別名稱已重複，不可新增`);
							$("#confirm_update").prop('disabled', true);
							$("#confirm_update").attr('style', 'background-color:gray');
							//修改類別時使用
						} else {
							$(".pclassnameErr").html('');
							$("#confirm_update").prop('disabled', false);
							$("#confirm_update").removeAttr('style');
							return true;
						}
					})
			}

		}

	</script>


</body>

</html>